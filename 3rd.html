<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± Ø«Ø§Ù„Ø«Ø© Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</title>
<style>
/* --- Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„ØµÙØ­Ø© --- */
body { 
    font-family: "Cairo", sans-serif; 
    margin: 0; 
    background: #f5f6fa; 
    color: #222; 
}
header { 
    display: flex; 
    justify-content: space-around; 
    align-items: center; 
    background: #0078d7; 
    color: white; 
    padding: 15px; 
    font-weight: bold; 
}
header button { 
    background: transparent; 
    border: none; 
    color: white; 
    font-size: 16px; 
    cursor: pointer; 
    transition: 0.3s; 
}
header button.active { 
    border-bottom: 3px solid #fff; 
}
main { 
    padding: 20px; 
}
.section { 
    display: none; 
}
.section.active { 
    display: block; 
}
.card { 
    background: white; 
    border-radius: 15px; 
    box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
    padding: 20px; 
    margin-bottom: 20px; 
    position: relative; 
}
label { 
    display: block; 
    margin-bottom: 6px; 
    font-weight: bold; 
}
select, input[type="text"], input[type="number"] { 
    width: 100%; 
    padding: 10px; 
    margin-bottom: 15px; 
    border: 1px solid #ccc; 
    border-radius: 10px; 
    font-size: 15px; 
}
.radio-group { 
    display: flex; 
    gap: 15px; 
    margin-bottom: 15px; 
}
.radio-group label { 
    font-weight: normal; 
}
button.submit-btn { 
    background: #0078d7; 
    color: white; 
    border: none; 
    border-radius: 10px; 
    padding: 10px 20px; 
    cursor: pointer; 
    font-size: 16px; 
    transition: 0.3s; 
}
button.submit-btn:disabled { 
    background: #aaa; 
    cursor: not-allowed; 
}
.suggestions { 
    position: absolute; 
    background: white; 
    border: 1px solid #ccc; 
    border-radius: 8px; 
    width: calc(100% - 40px); 
    max-height: 150px; 
    overflow-y: auto; 
    box-shadow: 0 4px 8px rgba(0,0,0,0.15); 
    z-index: 10; 
}
.suggestions div { 
    padding: 8px; 
    cursor: pointer; 
    transition: 0.2s; 
}
.suggestions div:hover { 
    background: #0078d7; 
    color: white; 
}
table { 
    border-collapse: collapse; 
    width: 100%; 
    margin-top: 10px; 
}
table, th, td { 
    border: 1px solid #ccc; 
}
th, td { 
    padding: 8px; 
    text-align: center; 
}
th { 
    background: #0078d7; 
    color: white; 
}

#attendanceSection, #reportsSection {
  position: relative;
  width: 100%;
  display: none; /* ÙƒÙ„ Ù‚Ø³Ù… Ù…Ø®ÙÙŠ Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ */
}

#attendanceSection.active, #reportsSection.active {
  display: block; /* Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù†Ø´Ø· ÙŠØ¸Ù‡Ø± */
}

@media (max-width:600px) { 
    .card { padding: 15px; } 
}
</style>
</head>
<body>
<header>
<button id="attendanceTab" class="active">ğŸ“‹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
<button id="reportsTab">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
</header>

<main>
<section id="attendanceSection" class="section active">
  <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± -->
  <div class="card">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ù†ÙˆØªØ©</h3>
    <label>Ø§Ù„Ø³Ù†Ø©</label><select id="yearSelect"></select>
    <label>Ø§Ù„Ø´Ù‡Ø±</label><select id="monthSelect"></select>
    <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label><select id="dateSelect"></select>
    <label>Ø§Ù„Ø§Ø³Ù…</label>
    <input type="text" id="nameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…...(Ù„Ø§Ø²Ù… Ù…Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª)">
    <div id="nameSuggestions" class="suggestions" style="display:none;"></div>
    <label>Ø§Ù„Ø­Ø¶ÙˆØ±</label>
    <div class="radio-group">
      <label><input type="radio" name="attendance" value="Ø­Ø¶Ø±"> Ø­Ø¶Ø±</label>
      <label><input type="radio" name="attendance" value="ØºØ§Ø¨"> ØºØ§Ø¨</label>
    </div>
    <label>Ø¬Ø§Ø¨ Ø§Ù„Ù†ÙˆØªØ©ØŸ</label>
    <div class="radio-group">
      <label><input type="radio" name="notebook" value="Ù†Ø¹Ù…"> Ù†Ø¹Ù…</label>
      <label><input type="radio" name="notebook" value="Ù„Ø§"> Ù„Ø§</label>
    </div>
    <button id="attendanceSubmit" class="submit-btn" disabled>Ø¥Ø±Ø³Ø§Ù„</button>
  </div>

  <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„ -->
  <div class="card">
  <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„</h3>
  <label>Ø§Ù„Ø§Ø³Ù…</label>
  <input type="text" id="interactionName" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…...">
  <div id="interactionSuggestions" class="suggestions" style="display:none;"></div>

  <label>Ø§Ù„Ø³Ù†Ø©</label>
<select id="interactionYearSelect"></select>

<label>Ø§Ù„Ø´Ù‡Ø±</label>
<select id="interactionMonthSelect"></select>

<label>Ø§Ù„ÙŠÙˆÙ…</label>
<select id="interactionDateSelect"></select>

  <label>Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙØ§Ø¹Ù„ (0 - 5)</label>
  <input type="number" id="interactionPoints" min="0" max="5">

  <button id="interactionSubmit" class="submit-btn" disabled>Ø¥Ø±Ø³Ø§Ù„</button>
</div>

    <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§ÙØªÙ‚Ø§Ø¯ -->
<div class="card">
  <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§ÙØªÙ‚Ø§Ø¯</h3>

  <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
  <select id="absenceYear"></select>
  <select id="absenceMonth"></select>
  <select id="absenceDate"></select>

  <label>Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„</label>
  <input type="text" id="absenceChildName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„...">
  <div id="absenceChildSuggestions" class="suggestions" style="display:none;"></div>

  <label>Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù…</label>
  <select id="absenceStaff">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø®Ø§Ø¯Ù…</option>
    <option value="Ø®Ø§Ø¯Ù…1">Ø®Ø§Ø¯Ù…1</option>
    <option value="Ø®Ø§Ø¯Ù…2">Ø®Ø§Ø¯Ù…2</option>
    <option value="Ø®Ø§Ø¯Ù…3">Ø®Ø§Ø¯Ù…3</option>
  </select>

  <label>Ù†ÙˆØ¹ Ø§Ù„Ø§ÙØªÙ‚Ø§Ø¯</label>
  <select id="absenceType">
    <option value="Ù…Ù†Ø²Ù„">Ù…Ù†Ø²Ù„</option>
    <option value="ØªÙŠÙ„ÙŠÙÙˆÙ†">ØªÙŠÙ„ÙŠÙÙˆÙ†</option>
  </select>

  <label>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
  <textarea id="absenceNotes" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø§..." rows="3"></textarea>

  <button id="absenceSubmit" class="submit-btn" disabled>Ø¥Ø±Ø³Ø§Ù„</button>
</div>
</section>

<section id="reportsSection" class="section">
  <!-- Ø£Ø¹ÙŠØ§Ø¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ -->
  <div class="card">
    <h3>Ø£Ø¹ÙŠØ§Ø¯ Ù…ÙŠÙ„Ø§Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„</h3>
    <label>Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±</label><select id="birthdayMonth"></select>
    <button id="birthdayShow" class="submit-btn">Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</button>
    <div id="birthdayResult"></div>
  </div>

  <!-- ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± -->
  <div class="card">
    <h3>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
    <label>Ø§Ù„Ø³Ù†Ø©</label><select id="reportYear"></select>
    <label>Ø§Ù„Ø´Ù‡Ø±</label><select id="reportMonth"></select>
    <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label><select id="reportDate"></select>
    <button id="showCount" class="submit-btn">Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¶ÙˆØ±</button>
    <button id="showNames" class="submit-btn">Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</button>
    <div id="attendanceReportResult"></div>
  </div>

  <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„ -->
  <div class="card">
    <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„</h3>
    <label>Ø§Ù„Ø§Ø³Ù…</label><input type="text" id="childInfoName" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…...">
    <div id="childInfoSuggestions" class="suggestions" style="display:none;"></div>
    <button id="showChildInfo" class="submit-btn">Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    <div id="childInfoResult"></div>
  </div>

  <!-- Ø­Ø¶ÙˆØ± Ø§Ù„Ø·ÙÙ„ ÙÙŠ Ø§Ù„Ø´Ù‡Ø± -->
  <div class="card">
    <h3>Ø­Ø¶ÙˆØ± Ø§Ù„Ø·ÙÙ„ ÙÙŠ Ø§Ù„Ø´Ù‡Ø±</h3>
    <label>Ø§Ù„Ø§Ø³Ù…</label><input type="text" id="childAttendanceName" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…...">
    <div id="childAttendanceSuggestions" class="suggestions" style="display:none;"></div>
    <label>Ø§Ù„Ø³Ù†Ø©</label><select id="childAttendanceYear"></select>
    <label>Ø§Ù„Ø´Ù‡Ø±</label><select id="childAttendanceMonth"></select>
    <button id="showChildAttendance" class="submit-btn">Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¶ÙˆØ±</button>
    <div id="childAttendanceResult"></div>
  </div>

  <!-- Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© -->
  <div class="card">
    <h3>Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
    <label>Ø§Ù„Ø§Ø³Ù…</label><input type="text" id="interactionReportName" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…...">
    <div id="interactionReportSuggestions" class="suggestions" style="display:none;"></div>
    <label>Ø§Ù„Ø³Ù†Ø©</label><select id="interactionReportYear"></select>
    <label>Ø§Ù„Ø´Ù‡Ø±</label><select id="interactionReportMonth"></select>
    <button id="showInteractionReport" class="submit-btn">Ø¹Ø±Ø¶ Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙØ§Ø¹Ù„</button>
    <div id="interactionReportResult"></div>
  </div>

    <!-- ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§ÙØªÙ‚Ø§Ø¯ -->
<div class="card">
  <h3>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§ÙØªÙ‚Ø§Ø¯</h3>
  <label>Ø§Ø®ØªØ± Ø§Ù„Ø·ÙÙ„</label>
  <input type="text" id="absenceReportChildName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„...">
  <div id="absenceReportSuggestions" class="suggestions" style="display:none;"></div>

  <label>Ø§Ø®ØªØ± Ø§Ù„Ø³Ù†Ø©</label>
  <select id="absenceReportYear"></select>

  <label>Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±</label>
  <select id="absenceReportMonth"></select>

  <button id="showAbsenceReport" class="submit-btn">Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§ÙØªÙ‚Ø§Ø¯</button>
  <div id="absenceReportResult"></div>
</div>

</section>
</main>

<script>
const apiURL="https://3rd.johnmamdouh777.workers.dev/";
const currentYear = new Date().getFullYear();
const months=["ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø£Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ","ÙŠÙˆÙ„ÙŠÙˆ","Ø£ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"];
fillYearSelect(document.getElementById("absenceYear"));
fillMonthSelect(document.getElementById("absenceMonth"));
fillYearSelect(document.getElementById("absenceReportYear"));



// --- Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ---
document.getElementById("attendanceTab").onclick = () => {
  document.getElementById("attendanceSection").classList.add("active");
  document.getElementById("reportsSection").classList.remove("active");
  document.getElementById("attendanceTab").classList.add("active");
  document.getElementById("reportsTab").classList.remove("active");
};

document.getElementById("reportsTab").onclick = () => {
  document.getElementById("attendanceSection").classList.remove("active");
  document.getElementById("reportsSection").classList.add("active");
  document.getElementById("attendanceTab").classList.remove("active");
  document.getElementById("reportsTab").classList.add("active");
};
    
// --- ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø³Ù†ÙˆØ§Øª ÙˆØ§Ù„Ø´Ù‡ÙˆØ± ---
function fillYearSelect(sel){
  if(!sel) return;
  sel.innerHTML = ""; // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø®ÙŠØ§Ø±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§
  for(let y=currentYear-1; y<=currentYear+1; y++){
    const opt = document.createElement("option");
    opt.value = y;
    opt.textContent = y;
    sel.appendChild(opt);
  }
}

fillYearSelect(document.getElementById("yearSelect"));
fillYearSelect(document.getElementById("reportYear"));
fillYearSelect(document.getElementById("childAttendanceYear"));
fillYearSelect(document.getElementById("interactionReportYear"));
fillYearSelect(document.getElementById("absenceReportYear"));

function fillMonthSelect(sel){
  if(!sel) return;
  sel.innerHTML = ""; // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø®ÙŠØ§Ø±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
  months.forEach((m,i)=>{
    const opt = document.createElement("option");
    opt.value = i+1;
    opt.textContent = m;
    sel.appendChild(opt);
  });
}


fillMonthSelect(document.getElementById("monthSelect"));
fillMonthSelect(document.getElementById("reportMonth"));
fillMonthSelect(document.getElementById("childAttendanceMonth"));
fillMonthSelect(document.getElementById("interactionReportMonth"));
fillMonthSelect(document.getElementById("birthdayMonth"));
fillMonthSelect(document.getElementById("absenceReportMonth"));

// --- ØªØ¹Ø¨Ø¦Ø© Ø£ÙŠØ§Ù… Ø§Ù„Ø¬Ù…Ø¹Ø© ---
function fillFridays(yearSel, monthSel, dateSel){
  dateSel.innerHTML="";
  const year=+yearSel.value;
  const month=+monthSel.value-1;
  const daysInMonth=new Date(year,month+1,0).getDate();
  for(let d=1; d<=daysInMonth; d++){
    const date=new Date(year,month,d);
    if(date.getDay()===5){
      const opt=document.createElement("option");
      opt.value=d; opt.textContent=`${d}/${month+1}/${year}`;
      dateSel.appendChild(opt);
    }
  }
}
fillFridays(document.getElementById("yearSelect"), document.getElementById("monthSelect"), document.getElementById("dateSelect"));
document.getElementById("yearSelect").onchange = () => fillFridays(document.getElementById("yearSelect"), document.getElementById("monthSelect"), document.getElementById("dateSelect"));
document.getElementById("monthSelect").onchange = () => fillFridays(document.getElementById("yearSelect"), document.getElementById("monthSelect"), document.getElementById("dateSelect"));

// --- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ---
let allNames = [];

async function loadNames(){
  try{
    const res = await fetch(apiURL+"?type=names");
    const data = await res.json();
    allNames = Array.isArray(data) ? data : (data.names || []);
  } catch(err){ 
    console.warn(err); 
  }
}

const nameInput = document.getElementById("nameInput");
const interactionName = document.getElementById("interactionName");
const childInfoName = document.getElementById("childInfoName");
const childAttendanceName = document.getElementById("childAttendanceName");
const interactionReportName = document.getElementById("interactionReportName");

// Ø§Ø®ØªØ± Ù…ÙƒØ§Ù† ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙÙ‚Ø· Ù…Ø±Ø©:
async function initAttendance(){
  await loadNames(); // Ù†Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
  // Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ù†Ø±Ø¨Ø· Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
  setupSuggestions(nameInput, document.getElementById("nameSuggestions"));
  setupSuggestions(interactionName, document.getElementById("interactionSuggestions"));
  setupSuggestions(childInfoName, document.getElementById("childInfoSuggestions"));
  setupSuggestions(childAttendanceName, document.getElementById("childAttendanceSuggestions"));
  setupSuggestions(interactionReportName, document.getElementById("interactionReportSuggestions"));
  setupSuggestions(document.getElementById("absenceChildName"), document.getElementById("absenceChildSuggestions"));
  setupSuggestions(document.getElementById("absenceReportChildName"), document.getElementById("absenceReportSuggestions"));
  checkAttendanceReady();
}
initAttendance();

// --- Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ---
function setupSuggestions(inputEl,suggestionsEl){
  inputEl.addEventListener("input",()=>{
    const q=inputEl.value.trim();
    if(!q) return suggestionsEl.style.display="none";
    const filtered=allNames.filter(n=>n.includes(q)).slice(0,10);
    if(filtered.length===0){ suggestionsEl.style.display="none"; return; }
    suggestionsEl.innerHTML="";
    filtered.forEach(name=>{
      const div=document.createElement("div");
      div.textContent=name;
      div.onclick = ()=>{ inputEl.value=name; suggestionsEl.style.display="none"; inputEl.dispatchEvent(new Event("input")); };
      suggestionsEl.appendChild(div);
    });
    suggestionsEl.style.display="block";
  });
  document.addEventListener("click",(e)=>{
    if(!inputEl.contains(e.target)&&!suggestionsEl.contains(e.target)) suggestionsEl.style.display="none";
  });
}
setupSuggestions(document.getElementById("nameInput"),document.getElementById("nameSuggestions"));
setupSuggestions(document.getElementById("interactionName"),document.getElementById("interactionSuggestions"));
setupSuggestions(document.getElementById("childInfoName"),document.getElementById("childInfoSuggestions"));
setupSuggestions(document.getElementById("childAttendanceName"),document.getElementById("childAttendanceSuggestions"));
setupSuggestions(document.getElementById("interactionReportName"),document.getElementById("interactionReportSuggestions"));

    const absenceSubmit = document.getElementById("absenceSubmit");
const absenceChildNameInput = document.getElementById("absenceChildName");
const absenceStaffSelect = document.getElementById("absenceStaff");

function checkAbsenceReady() {
  const nameValid = allNames.includes(absenceChildNameInput.value.trim());
  const staffSelected = absenceStaffSelect.value !== "";
  absenceSubmit.disabled = !(nameValid && staffSelected);
}

absenceChildNameInput.addEventListener("input", checkAbsenceReady);
absenceStaffSelect.addEventListener("change", checkAbsenceReady);
checkAbsenceReady();

    absenceSubmit.addEventListener("click", async () => {
  const name = absenceChildNameInput.value.trim();
  const year = document.getElementById("absenceYear").value;
  const month = document.getElementById("absenceMonth").value;
  const date = document.getElementById("absenceDate").value;
  const staff = absenceStaffSelect.value;
  const type = document.getElementById("absenceType").value;
  const notes = document.getElementById("absenceNotes").value.trim();

  absenceSubmit.disabled = true;

  try {
    const res = await fetch(apiURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        type: "absence",
        name, year, month, date,
        staff, absenceType: type, notes
      })
    });
    const result = await res.json();
    if(result.success){
      alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§ÙØªÙ‚Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­!");
      absenceChildNameInput.value = "";
      absenceStaffSelect.value = "";
      document.getElementById("absenceNotes").value = "";
      checkAbsenceReady();
    } else {
      alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„.");
    }
  } catch {
    alert("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….");
  } finally {
    absenceSubmit.disabled = false;
  }
});

// --- ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø­Ø¶ÙˆØ± ---
const attendanceRadios = document.querySelectorAll('input[name="attendance"]');
const notebookRadios = document.querySelectorAll('input[name="notebook"]');
const attendanceSubmit = document.getElementById("attendanceSubmit");

function checkAttendanceReady(){
  const validName = allNames.includes(nameInput.value.trim());
  const attendanceChecked = Array.from(attendanceRadios).some(r=>r.checked);
  const notebookChecked = Array.from(notebookRadios).some(r=>r.checked);
  attendanceSubmit.disabled = !(validName && attendanceChecked && notebookChecked);
}
nameInput.addEventListener("input", checkAttendanceReady);
attendanceRadios.forEach(r=>r.addEventListener("change", checkAttendanceReady));
notebookRadios.forEach(r=>r.addEventListener("change", checkAttendanceReady));
checkAttendanceReady();

// --- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± ---
attendanceSubmit.addEventListener("click", async ()=>{
  const name=nameInput.value.trim();
  const attendance=document.querySelector('input[name="attendance"]:checked').value;
  const notebook=document.querySelector('input[name="notebook"]:checked').value;
  const year=document.getElementById("yearSelect").value;
  const month=document.getElementById("monthSelect").value;
  const date=document.getElementById("dateSelect").value;

  // --- ØªØ­Ù‚Ù‚ Ù…Ø³Ø¨Ù‚ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„Ø­Ø¶ÙˆØ± ---
try {
  const checkRes = await fetch(`${apiURL}?type=checkAttendance&name=${encodeURIComponent(name)}&year=${year}&month=${month}&date=${encodeURIComponent(date)}`);
  const checkData = await checkRes.json();
  if(checkData.exists) {
    alert(`âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©: ${name}`);
    return; // ØªÙˆÙ‚Ù Ø§Ù„ØªÙ†ÙÙŠØ° Ù‡Ù†Ø§
  }
} catch {
  alert("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¶ÙˆØ±.");
  return;
}

  attendanceSubmit.disabled=true;
  const data={ type:"attendance", year, month, date, name, attendance, notebook };
  try{
    const res=await fetch(apiURL, { method:"POST", headers:{ "Content-Type":"application/json" }, body:JSON.stringify(data) });
    const result=await res.json();
    if(result.success){
      alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!");
      nameInput.value="";
      attendanceRadios.forEach(r=>r.checked=false);
      notebookRadios.forEach(r=>r.checked=false);
      checkAttendanceReady();
    }else alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„.");
  }catch{ alert("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…."); }
  finally{ attendanceSubmit.disabled=false; }
});

// --- ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ ---
const interactionPoints=document.getElementById("interactionPoints");
const interactionSubmit=document.getElementById("interactionSubmit");

function checkInteractionReady(){
  const name=interactionName.value.trim();
  const points=Number(interactionPoints.value);
  const validName=allNames.includes(name);
  const validPoints=!isNaN(points) && points>=0 && points<=5;
  interactionSubmit.disabled=!(name && validPoints && validName);
}
interactionName.addEventListener("input", checkInteractionReady);
interactionPoints.addEventListener("input", checkInteractionReady);
checkInteractionReady();

// --- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ ---
// --- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø± ---
interactionSubmit.addEventListener("click", async ()=> {
  const name = interactionName.value.trim();
  const year = Number(document.getElementById("interactionYearSelect").value);
  const month = Number(document.getElementById("interactionMonthSelect").value);
  const date = Number(document.getElementById("interactionDateSelect").value);
  const points = Number(interactionPoints.value);

  if(!name || !date || !month || !year || isNaN(points) || points < 0 || points > 5){
    return alert("ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù†Ù‚Ø§Ø· Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
  }

  // âœ… ØªØ­Ù‚Ù‚ Ù…Ø³Ø¨Ù‚ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
  try {
    const checkRes = await fetch(`${apiURL}?type=checkInteraction&name=${encodeURIComponent(name)}&year=${year}&month=${month}&day=${date}`);
    const checkData = await checkRes.json();
    if (checkData.exists) {
      alert(`âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø· ØªÙØ§Ø¹Ù„ Ù„Ù†ÙØ³ Ø§Ù„ÙŠÙˆÙ… Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ (${name})`);
      return; // ÙˆÙ‚Ù Ø§Ù„ØªÙ†ÙÙŠØ° Ù‡Ù†Ø§
    }
  } catch {
    alert("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø±.");
    return;
  }

  interactionSubmit.disabled = true;

  try {
    const res = await fetch(apiURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        type: "interaction",
        name,
        date,
        month,
        year,
        points
      })
    });
    const result = await res.json();
    if(result.success){
      alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø¨Ù†Ø¬Ø§Ø­!");
      interactionName.value = "";
      interactionPoints.value = "";
      checkInteractionReady();
    } else {
      alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„.");
    }
  } catch {
    alert("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….");
  } finally {
    interactionSubmit.disabled = false;
  }
});

// --- Ø¯ÙˆØ§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ---
function renderListAsTable(container, arr, colName="Ø§Ù„Ø§Ø³Ù…"){
  if(!arr || arr.length===0){ container.innerHTML="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª"; return; }
  container.innerHTML = `<table><tr><th>${colName}</th></tr>` + arr.map(x=>`<tr><td>${x}</td></tr>`).join("") + "</table>";
}
function renderObjectAsTable(container, obj){
  if(!obj || Object.keys(obj).length===0){ container.innerHTML="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª"; return; }
  container.innerHTML = `<table>` + Object.entries(obj).map(([k,v])=>`<tr><th>${k}</th><td>${v}</td></tr>`).join("") + `</table>`;
}
function renderArrayOfObjectsAsTable(container, arr, headers){
  if(!arr || arr.length===0){ container.innerHTML="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª"; return; }
  container.innerHTML = `<table><tr>${headers.map(h=>`<th>${h}</th>`).join("")}</tr>` +
    arr.map(row=>`<tr>${headers.map(h=>`<td>${row[h]||""}</td>`).join("")}</tr>`).join("") + `</table>`;
}
  // --- Ø£Ø¹ÙŠØ§Ø¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ---
document.getElementById("birthdayShow").addEventListener("click", async () => {
  const monthIndex = document.getElementById("birthdayMonth").value; // Ø¯Ù‡ Ø±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø± 1-12
  const container = document.getElementById("birthdayResult");
  container.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
  try {
    const res = await fetch(`${apiURL}?type=birthdaysReport&month=${monthIndex}`);
    const data = await res.json();
    // Ù‡Ù†Ø§ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ø¬Ø¯ÙˆÙ„
    if(data.records && data.records.length > 0){
      container.innerHTML = `<table><tr><th>Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„</th><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„Ø´Ù‡Ø±</th><th>Ø§Ù„Ø³Ù†Ø©</th></tr>` +
        data.records.map(r=>`<tr><td>${r.name}</td><td>${r.day}</td><td>${r.month}</td><td>${r.year}</td></tr>`).join("") +
        `</table>`;
    } else {
      container.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±";
    }
  } catch (err) {
    console.error(err);
    container.innerHTML = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….";
  }
});

// --- ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ---
document.getElementById("showCount").addEventListener("click", async () => {
  const year = document.getElementById("reportYear").value;
  const month = document.getElementById("reportMonth").value;
  const date = document.getElementById("reportDate").value;
  const container = document.getElementById("attendanceReportResult");
  container.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
  try {
    const res = await fetch(`${apiURL}?type=attendanceCount&year=${year}&month=${month}&date=${date}`);
    const data = await res.json();
    container.innerHTML = `Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¶ÙˆØ±: ${data.count || 0}`;
  } catch {
    container.innerHTML = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….";
  }
});

document.getElementById("showNames").addEventListener("click", async () => {
  const year = document.getElementById("reportYear").value;
  const month = document.getElementById("reportMonth").value;
  const date = document.getElementById("reportDate").value;
  const container = document.getElementById("attendanceReportResult");
  container.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
  try {
    const res = await fetch(`${apiURL}?type=attendanceNames&year=${year}&month=${month}&date=${date}`);
    const data = await res.json();
    renderListAsTable(container, data.names || [], "Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„");
  } catch {
    container.innerHTML = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….";
  }
});

// --- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„ ---
document.getElementById("showChildInfo").addEventListener("click", async () => {
  const name = document.getElementById("childInfoName").value.trim();
  const container = document.getElementById("childInfoResult");
  if(!name){ container.innerHTML="âŒ Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø£ÙˆÙ„Ù‹Ø§"; return; }
  container.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
  try {
    const res = await fetch(`${apiURL}?type=childInfo&name=${encodeURIComponent(name)}`);
    const data = await res.json();
    if (data && data.records && data.records.length > 0) {
  const record = data.records[0];
  let infoHtml = `<div class="child-info-table"><table>`;
  for (const [key, value] of Object.entries(record)) {
        if (key === "Ø§Ù„ØµÙˆØ±Ø©" && value.includes("drive.google.com")) {
          const idMatch = value.match(/\/d\/([^/]+)/);
          const imgSrc = idMatch ? `https://drive.google.com/uc?export=view&id=${idMatch[1]}` : value;
          infoHtml += `<tr><th>${key}</th><td><img src="${imgSrc}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø·ÙÙ„" style="width:150px;border-radius:10px"></td></tr>`;
        } else {
          infoHtml += `<tr><th>${key}</th><td>${value}</td></tr>`;
        }
      }
      infoHtml += `</table></div>`;
      container.innerHTML = infoHtml;
    } else {
      container.innerHTML = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù….";
    }
  } catch (err) {
    container.innerHTML = "âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
    console.error(err);
  }
});

// --- Ø­Ø¶ÙˆØ± Ø§Ù„Ø·ÙÙ„ ÙÙŠ Ø§Ù„Ø´Ù‡Ø± ---
document.getElementById("showChildAttendance").addEventListener("click", async () => {
  const name = document.getElementById("childAttendanceName").value.trim();
  const year = document.getElementById("childAttendanceYear").value;
  const month = document.getElementById("childAttendanceMonth").value;
  const container = document.getElementById("childAttendanceResult");
  if(!name) return alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„");
  container.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
  try {
    const res = await fetch(`${apiURL}?type=childAttendance&name=${encodeURIComponent(name)}&year=${year}&month=${month}`);
    const data = await res.json();
    renderArrayOfObjectsAsTable(container, data.records || [], ["date", "attendance", "notebook"]);
  } catch {
    container.innerHTML = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….";
  }
});

// --- Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© ---
document.getElementById("showInteractionReport").addEventListener("click", async () => {
  const name = document.getElementById("interactionReportName").value.trim();
  const year = document.getElementById("interactionReportYear").value;
  const month = document.getElementById("interactionReportMonth").value;
  const container = document.getElementById("interactionReportResult");
  if(!name) return alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„");
  container.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
  try {
    const res = await fetch(`${apiURL}?type=interactionReport&name=${encodeURIComponent(name)}&year=${year}&month=${month}`);
    const data = await res.json();
    renderArrayOfObjectsAsTable(container, data.records || [], ["date", "points"]);
  } catch {
    container.innerHTML = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….";
  }
});

  function fillFridaysForReport(){
  const yearSel = document.getElementById("reportYear");
  const monthSel = document.getElementById("reportMonth");
  const dateSel = document.getElementById("reportDate");
  dateSel.innerHTML = "";
  const year = +yearSel.value;
  const month = +monthSel.value - 1;
  const daysInMonth = new Date(year, month+1, 0).getDate();
  for(let d=1; d<=daysInMonth; d++){
    const date = new Date(year, month, d);
    if(date.getDay() === 5){ // Ø¬Ù…Ø¹Ù‡
      const opt = document.createElement("option");
      opt.value = d;
      opt.textContent = `${d}/${month+1}/${year}`;
      dateSel.appendChild(opt);
    }
  }
}

// Ø±Ø¨Ø·Ù‡Ø§ Ù…Ø¹ ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ù†Ø© ÙˆØ§Ù„Ø´Ù‡Ø±
document.getElementById("reportYear").onchange = fillFridaysForReport;
document.getElementById("reportMonth").onchange = fillFridaysForReport;

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
fillFridaysForReport();

    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø³Ù†ÙˆØ§Øª Ù„Ù„Ø´Ù‡ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªÙØ§Ø¹Ù„
fillYearSelect(document.getElementById("interactionYearSelect"));

// ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø´Ù‡ÙˆØ± Ù„Ù„Ø´Ù‡ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªÙØ§Ø¹Ù„
fillMonthSelect(document.getElementById("interactionMonthSelect"));
    
    function fillInteractionFridays() {
  const yearSel = document.getElementById("interactionYearSelect");
  const monthSel = document.getElementById("interactionMonthSelect");
  const dateSel = document.getElementById("interactionDateSelect");
  dateSel.innerHTML = "";
  const year = +yearSel.value;
  const month = +monthSel.value - 1;
  const daysInMonth = new Date(year, month+1, 0).getDate();
  for(let d=1; d<=daysInMonth; d++){
    const date = new Date(year, month, d);
    if(date.getDay() === 5){ // ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©
      const opt = document.createElement("option");
      opt.value = d;
      opt.textContent = `${d}/${month+1}/${year}`;
      dateSel.appendChild(opt);
    }
  }
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ù†Ø© Ø£Ùˆ Ø§Ù„Ø´Ù‡Ø±
document.getElementById("interactionYearSelect").onchange = fillInteractionFridays;
document.getElementById("interactionMonthSelect").onchange = fillInteractionFridays;

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
fillInteractionFridays();

    document.getElementById("showAbsenceReport").addEventListener("click", async () => {
  const name = document.getElementById("absenceReportChildName").value.trim();
  const year = document.getElementById("absenceReportYear").value;
  const month = document.getElementById("absenceReportMonth").value;
  const container = document.getElementById("absenceReportResult");
  
  if (!name) {
    alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„");
    return;
  }
  
  container.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
  
  try {
    const res = await fetch(`${apiURL}?type=absenceReport&name=${encodeURIComponent(name)}&year=${year}&month=${month}`);
    const data = await res.json();
    if (data.records && data.records.length > 0) {
      container.innerHTML = `<table>
        <tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ù†ÙˆØ¹ Ø§Ù„Ø§ÙØªÙ‚Ø§Ø¯</th><th>Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù…</th><th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr>` +
        data.records.map(r=>`<tr><td>${r.date}/${r.month}/${r.year}</td><td>${r.absenceType}</td><td>${r.staff}</td><td>${r.notes}</td></tr>`).join("") +
        `</table>`;
    } else {
      container.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·ÙÙ„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±";
    }
  } catch {
    container.innerHTML = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….";
  }
});

    function fillAbsenceDates() {
  const yearSel = document.getElementById("absenceYear");
  const monthSel = document.getElementById("absenceMonth");
  const dateSel = document.getElementById("absenceDate");
  dateSel.innerHTML = "";
  const year = +yearSel.value;
  const month = +monthSel.value - 1;
  const daysInMonth = new Date(year, month+1, 0).getDate();
  for(let d=1; d<=daysInMonth; d++){
    const opt = document.createElement("option");
    opt.value = d;
    opt.textContent = `${d}/${month+1}/${year}`;
    dateSel.appendChild(opt);
  }
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ù†Ø© Ø£Ùˆ Ø§Ù„Ø´Ù‡Ø±
document.getElementById("absenceYear").onchange = fillAbsenceDates;
document.getElementById("absenceMonth").onchange = fillAbsenceDates;

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
fillAbsenceDates();

    async function showAbsenceReport() {
  const name = document.getElementById("absenceReportName").value.trim();
  const year = document.getElementById("absenceReportYear").value;
  const month = document.getElementById("absenceReportMonth").value;

  if (!name || !year || !month) {
    alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ù†Ø© ÙˆØ§Ù„Ø´Ù‡Ø± Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }

  try {
    const response = await fetch(`${SCRIPT_URL}?type=absenceReport&name=${encodeURIComponent(name)}&year=${year}&month=${month}`);
    const data = await response.json();

    console.log("ğŸ” absence report data:", data.records); // Ø¹Ø´Ø§Ù† ØªØ´ÙˆÙ Ø´ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ console

    const tableBody = document.getElementById("absenceReportTableBody");
    tableBody.innerHTML = "";

    if (!data.records || data.records.length === 0) {
      tableBody.innerHTML = `<tr><td colspan="4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªÙ‚Ø§Ø¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·ÙÙ„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</td></tr>`;
      return;
    }

    // Ø¹Ø±Ø¶ ÙƒÙ„ Ø³Ø¬Ù„ Ø§ÙØªÙ‚Ø§Ø¯
    data.records.forEach(r => {
      // Ù„Ùˆ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¹Ù†Ø¯Ùƒ ÙÙŠ Ø§Ù„Ø´ÙŠØª Ù…Ø±ØªØ¨Ø© ÙƒØ§Ù„ØªØ§Ù„ÙŠ:
      // Ø§Ù„Ø§Ø³Ù… | Ø§Ù„Ø³Ù†Ø© | Ø§Ù„Ø´Ù‡Ø± | Ø§Ù„ØªØ§Ø±ÙŠØ® | Ø§Ù„Ø­Ø¶ÙˆØ± | Ø¬Ø§Ø¨ Ø§Ù„Ù†ÙˆØªØ© | Ø§Ù„ØªÙØ§Ø¹Ù„ | Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„ | Ù†ÙˆØ¹ Ø§Ù„Ø§ÙØªÙ‚Ø§Ø¯ | Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù… | Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
      // ÙŠØ¨Ù‚Ù‰ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ù‡ØªÙƒÙˆÙ† Ø¨Ø§Ù„Ø´ÙƒÙ„ Ø¯Ù‡:
      const yearVal = r.year || r[1] || "";
      const monthVal = r.month || r[2] || "";
      const dateVal = r.date || r[3] || "";
      const absenceType = r.absenceType || r["Ù†ÙˆØ¹ Ø§Ù„Ø§ÙØªÙ‚Ø§Ø¯"] || r[8] || "";
      const staff = r.staff || r["Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù…"] || r[9] || "";
      const notes = r.notes || r["Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø§ÙØªÙ‚Ø§Ø¯"] || r[10] || "";

      const row = `
        <tr>
          <td>${dateVal}/${monthVal}/${yearVal}</td>
          <td>${absenceType}</td>
          <td>${staff}</td>
          <td>${notes}</td>
        </tr>
      `;
      tableBody.insertAdjacentHTML("beforeend", row);
    });

  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§ÙØªÙ‚Ø§Ø¯:", err);
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
  }
}

</script>
</body>
</html>
