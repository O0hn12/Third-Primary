<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± Ø«Ø§Ù„Ø«Ø© Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</title>
  <style>
    body {
      font-family: "Cairo", sans-serif;
      margin: 0;
      background: #f5f6fa;
      color: #222;
    }

    header {
      display: flex;
      justify-content: space-around;
      align-items: center;
      background: #0078d7;
      color: white;
      padding: 15px;
      font-weight: bold;
    }

    header button {
      background: transparent;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s;
    }

    header button.active {
      border-bottom: 3px solid #fff;
    }

    main {
      padding: 20px;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    .card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
      position: relative;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
    }

    select, input[type="text"], input[type="number"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 15px;
    }

    .radio-group {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }

    .radio-group label {
      font-weight: normal;
    }

    button.submit-btn {
      background: #0078d7;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 16px;
      transition: 0.3s;
    }

    button.submit-btn:disabled {
      background: #aaa;
      cursor: not-allowed;
    }

    /* Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª */
    .suggestions {
      position: absolute;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      width: calc(100% - 40px);
      max-height: 150px;
      overflow-y: auto;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      z-index: 10;
    }

    .suggestions div {
      padding: 8px;
      cursor: pointer;
      transition: 0.2s;
    }

    .suggestions div:hover {
      background: #0078d7;
      color: white;
    }

    @media (max-width: 600px) {
      .card {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <header>
    <button id="attendanceTab" class="active">ğŸ“‹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
    <button id="reportsTab">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
  </header>

  <main>
    <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
    <section id="attendanceSection" class="section active">
      <div class="card">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ù†ÙˆØªØ©</h3>
        <label>Ø§Ù„Ø³Ù†Ø©</label>
        <select id="yearSelect"></select>

        <label>Ø§Ù„Ø´Ù‡Ø±</label>
        <select id="monthSelect"></select>

        <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
        <select id="dateSelect"></select>

        <label>Ø§Ù„Ø§Ø³Ù…</label>
        <input type="text" id="nameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…...">
        <div id="nameSuggestions" class="suggestions" style="display:none;"></div>

        <label>Ø§Ù„Ø­Ø¶ÙˆØ±</label>
        <div class="radio-group">
          <label><input type="radio" name="attendance" value="Ø­Ø¶Ø±"> Ø­Ø¶Ø±</label>
          <label><input type="radio" name="attendance" value="ØºØ§Ø¨"> ØºØ§Ø¨</label>
        </div>

        <label>Ø¬Ø§Ø¨ Ø§Ù„Ù†ÙˆØªØ©ØŸ</label>
        <div class="radio-group">
          <label><input type="radio" name="notebook" value="Ù†Ø¹Ù…"> Ù†Ø¹Ù…</label>
          <label><input type="radio" name="notebook" value="Ù„Ø§"> Ù„Ø§</label>
        </div>

        <button id="attendanceSubmit" class="submit-btn" disabled>Ø¥Ø±Ø³Ø§Ù„</button>
      </div>

      <div class="card">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„</h3>
        <label>Ø§Ù„Ø§Ø³Ù…</label>
        <input type="text" id="interactionName" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…...">
        <div id="interactionSuggestions" class="suggestions" style="display:none;"></div>

        <label>Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙØ§Ø¹Ù„ (0 - 5)</label>
        <input type="number" id="interactionPoints" min="0" max="5">

        <button id="interactionSubmit" class="submit-btn" disabled>Ø¥Ø±Ø³Ø§Ù„</button>
      </div>
    </section>

    <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
    <section id="reportsSection" class="section">
      <div class="card">
        <h3>ğŸ“Š ØµÙØ­Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
        <p>Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù‡Ù†Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§.</p>
      </div>
    </section>
  </main>

  <script>
    // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
    const attendanceTab = document.getElementById("attendanceTab");
    const reportsTab = document.getElementById("reportsTab");
    const attendanceSection = document.getElementById("attendanceSection");
    const reportsSection = document.getElementById("reportsSection");

    attendanceTab.onclick = () => {
      attendanceTab.classList.add("active");
      reportsTab.classList.remove("active");
      attendanceSection.classList.add("active");
      reportsSection.classList.remove("active");
    };

    reportsTab.onclick = () => {
      reportsTab.classList.add("active");
      attendanceTab.classList.remove("active");
      reportsSection.classList.add("active");
      attendanceSection.classList.remove("active");
    };

    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
    const yearSelect = document.getElementById("yearSelect");
    const monthSelect = document.getElementById("monthSelect");
    const dateSelect = document.getElementById("dateSelect");

    const currentYear = new Date().getFullYear();
    for (let y = currentYear - 1; y <= currentYear + 1; y++) {
      const option = document.createElement("option");
      option.value = y;
      option.textContent = y;
      yearSelect.appendChild(option);
    }

    const months = [
      "ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø£Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ",
      "ÙŠÙˆÙ„ÙŠÙˆ","Ø£ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"
    ];
    months.forEach((m, i) => {
      const opt = document.createElement("option");
      opt.value = i + 1;
      opt.textContent = m;
      monthSelect.appendChild(opt);
    });

    function fillFridays() {
      dateSelect.innerHTML = "";
      const year = +yearSelect.value;
      const month = +monthSelect.value - 1;
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      for (let d = 1; d <= daysInMonth; d++) {
        const date = new Date(year, month, d);
        if (date.getDay() === 5) {
          const opt = document.createElement("option");
          opt.value = d;
          opt.textContent = `${d}/${month + 1}/${year}`;
          dateSelect.appendChild(opt);
        }
      }
    }
    yearSelect.onchange = fillFridays;
    monthSelect.onchange = fillFridays;
    fillFridays();

    // Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø­Ø¶ÙˆØ±
    const attendanceSubmit = document.getElementById("attendanceSubmit");
    function checkAttendanceReady() {
      const name = document.getElementById("nameInput").value.trim();
      const att = document.querySelector('input[name="attendance"]:checked');
      const note = document.querySelector('input[name="notebook"]:checked');
      attendanceSubmit.disabled = !(yearSelect.value && monthSelect.value && dateSelect.value && name && att && note);
    }
    document.querySelectorAll('input, select').forEach(el => el.addEventListener("input", checkAttendanceReady));

    // Ø²Ø± Ø§Ù„ØªÙØ§Ø¹Ù„
    const interactionName = document.getElementById("interactionName");
    const interactionPoints = document.getElementById("interactionPoints");
    const interactionSubmit = document.getElementById("interactionSubmit");
    function checkInteractionReady() {
      const name = interactionName.value.trim();
      const points = interactionPoints.value;
      interactionSubmit.disabled = !(name && points !== "");
    }
    interactionName.addEventListener("input", checkInteractionReady);
    interactionPoints.addEventListener("input", checkInteractionReady);

    // API
    const apiURL = "https://3rd.johnmamdouh777.workers.dev/";
    let allNames = [];

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
    async function loadNames() {
  try {
    const res = await fetch(apiURL + "?type=names");
    const data = await res.json();
    allNames = Array.isArray(data) ? data : data.names || [];
    console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡:", allNames.length);
  } catch (err) {
    console.warn("âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡", err);
  }
}
    loadNames();

    // Ø¥Ù†Ø´Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¹Ø§Ù…Ø©
    function setupSuggestions(inputEl, suggestionsEl) {
      inputEl.addEventListener("input", () => {
        const query = inputEl.value.trim();
        if (!query) return (suggestionsEl.style.display = "none");

        const filtered = allNames.filter(n => n.includes(query)).slice(0, 10);
        if (filtered.length === 0) {
          suggestionsEl.style.display = "none";
          return;
        }

        suggestionsEl.innerHTML = "";
        filtered.forEach(name => {
          const div = document.createElement("div");
          div.textContent = name;
          div.onclick = () => {
            inputEl.value = name;
            suggestionsEl.style.display = "none";
            inputEl.dispatchEvent(new Event("input"));
          };
          suggestionsEl.appendChild(div);
        });
        suggestionsEl.style.display = "block";
      });

      document.addEventListener("click", (e) => {
        if (!inputEl.contains(e.target) && !suggestionsEl.contains(e.target)) {
          suggestionsEl.style.display = "none";
        }
      });
    }

    setupSuggestions(
      document.getElementById("nameInput"),
      document.getElementById("nameSuggestions")
    );
    setupSuggestions(
      document.getElementById("interactionName"),
      document.getElementById("interactionSuggestions")
    );

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    attendanceSubmit.addEventListener("click", async () => {
      const year = yearSelect.value;
      const month = monthSelect.value;
      const date = dateSelect.options[dateSelect.selectedIndex].text;
      const name = document.getElementById("nameInput").value.trim();
      const attendance = document.querySelector('input[name="attendance"]:checked').value;
      const notebook = document.querySelector('input[name="notebook"]:checked').value;

      attendanceSubmit.disabled = true;

      const data = { type: "attendance", year, month, date, name, attendance, notebook };

      try {
        const res = await fetch(apiURL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });
        const result = await res.json();

        if (result.success) {
          alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!");
          document.getElementById("nameInput").value = "";
          document.querySelectorAll('input[name="attendance"]').forEach(e => e.checked = false);
          document.querySelectorAll('input[name="notebook"]').forEach(e => e.checked = false);
          checkAttendanceReady();
        } else {
          alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„.");
        }
      } catch {
        alert("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….");
      } finally {
        attendanceSubmit.disabled = false;
      }
    });

    interactionSubmit.addEventListener("click", async () => {
      const name = interactionName.value.trim();
      const points = interactionPoints.value;

      interactionSubmit.disabled = true;

      const data = { type: "interaction", name, points };

      try {
        const res = await fetch(apiURL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });
        const result = await res.json();

        if (result.success) {
          alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø¨Ù†Ø¬Ø§Ø­!");
          interactionName.value = "";
          interactionPoints.value = "";
          checkInteractionReady();
        } else {
          alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„.");
        }
      } catch {
        alert("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….");
      } finally {
        interactionSubmit.disabled = false;
      }
    });
  </script>
</body>
</html>
