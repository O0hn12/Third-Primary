<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ูุธุงู ุญุถูุฑ ุซุงูุซุฉ ุงุจุชุฏุงุฆู</title>
<link rel="icon" type="image/png" href="https://i.ibb.co/LDTWz9vs/Logo-HQ.png">
<style>
/* --- ุฃุณุงุณูุงุช ุงูุตูุญุฉ --- */
body { 
    font-family: "Cairo", sans-serif; 
    margin: 0; 
    background: #f5f6fa; 
    color: #222; 
}
header { 
    display: flex; 
    justify-content: space-around; 
    align-items: center; 
    background: #0078d7; 
    color: white; 
    padding: 15px; 
    font-weight: bold; 
}
header button { 
    background: transparent; 
    border: none; 
    color: white; 
    font-size: 16px; 
    cursor: pointer; 
    transition: 0.3s; 
}
header button.active { 
    border-bottom: 3px solid #fff; 
}
main { 
    padding: 20px; 
}
.section { 
    display: none; 
}
.section.active { 
    display: block; 
}
.card { 
    background: white; 
    border-radius: 15px; 
    box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
    padding: 20px; 
    margin-bottom: 20px; 
    position: relative; 
}
label { 
    display: block; 
    margin-bottom: 6px; 
    font-weight: bold; 
}
select, input[type="text"], input[type="number"] { 
    width: 100%; 
    padding: 10px; 
    margin-bottom: 15px; 
    border: 1px solid #ccc; 
    border-radius: 10px; 
    font-size: 15px; 
}
.radio-group { 
    display: flex; 
    gap: 15px; 
    margin-bottom: 15px; 
}
.radio-group label { 
    font-weight: normal; 
}
button.submit-btn { 
    background: #0078d7; 
    color: white; 
    border: none; 
    border-radius: 10px; 
    padding: 10px 20px; 
    cursor: pointer; 
    font-size: 16px; 
    transition: 0.3s; 
}
button.submit-btn:disabled { 
    background: #aaa; 
    cursor: not-allowed; 
}
.suggestions { 
    position: absolute; 
    background: white; 
    border: 1px solid #ccc; 
    border-radius: 8px; 
    width: calc(100% - 40px); 
    max-height: 150px; 
    overflow-y: auto; 
    box-shadow: 0 4px 8px rgba(0,0,0,0.15); 
    z-index: 10; 
}
.suggestions div { 
    padding: 8px; 
    cursor: pointer; 
    transition: 0.2s; 
}
.suggestions div:hover { 
    background: #0078d7; 
    color: white; 
}
table { 
    border-collapse: collapse; 
    width: 100%; 
    margin-top: 10px; 
}
table, th, td { 
    border: 1px solid #ccc; 
}
th, td { 
    padding: 8px; 
    text-align: center; 
}
th { 
    background: #0078d7; 
    color: white; 
}

#attendanceSection, #reportsSection {
  position: relative;
  width: 100%;
  display: none; /* ูู ูุณู ูุฎูู ุจุดูู ุงูุชุฑุงุถู */
}

#attendanceSection.active, #reportsSection.active {
  display: block; /* ุงููุณู ุงููุดุท ูุธูุฑ */
}

    #mainApp { display: none; }

@media (max-width:600px) { 
    .card { padding: 15px; } 
}
</style>
</head>
<body>
    
  <!-- ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู -->
<div id="loginSection" 
     style="display:flex;align-items:center;justify-content:center;height:100vh;background:url('https://i.ibb.co/SD5Z9fwx/8190346.jpg') center center / cover no-repeat;position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000;">
  <div style="background:rgba(255,255,255,0.8);padding:30px 25px;border-radius:15px;box-shadow:0 4px 10px rgba(0,0,0,0.1);width:300px;text-align:center;">
    <h2 style="margin-bottom:25px;color:#0078d7;">ุชุณุฌูู ุงูุฏุฎูู</h2>

    <input type="text" id="username" placeholder="ุงุณู ุงููุณุชุฎุฏู" 
  style="width:100%;padding:10px;margin-bottom:15px;border:1px solid #ccc;border-radius:10px;font-size:16px;text-align:center;background:rgba(255,255,255,0.6);color:#222;">

    <input type="password" id="password" placeholder="ูููุฉ ุงููุฑูุฑ"
  style="width:100%;padding:10px;margin-bottom:20px;border:1px solid #ccc;border-radius:10px;font-size:16px;text-align:center;background:rgba(255,255,255,0.6);color:#222;">

    <button id="loginBtn"
  style="width:100%;background:rgba(0,120,215,0.7);color:white;border:none;padding:10px;font-size:16px;border-radius:10px;cursor:pointer;transition:0.3s;">
      ุฏุฎูู ๐
    </button>

    <p id="loginError" style="margin-top:15px;color:red;display:none;">โ ุงุณู ุงููุณุชุฎุฏู ุฃู ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ</p>
  </div>
</div>

  <!-- ุจุงูู ุงููููุน -->
  <div id="mainContent" 
     style="display:none; position:relative; width:100%; min-height:100vh; background:#f5f6fa; z-index:1;">

<header>
<button id="attendanceTab" class="active">๐ ุงูุชุณุฌูู</button>
<button id="reportsTab">๐ ุงูุชูุงุฑูุฑ</button>
<button id="addEditTab">โ๐ป๏ธ ุฅุถุงูุฉ / ุชุนุฏูู</button>

</header>
   
<main>

<section id="attendanceSection" class="section active">
  <!-- ุชุณุฌูู ุงูุญุถูุฑ -->
  <div class="card">
    <h3>ุชุณุฌูู ุงูุญุถูุฑ ูุงูููุชุฉ</h3>
    <label>ุงูุณูุฉ</label><select id="yearSelect"></select>
    <label>ุงูุดูุฑ</label><select id="monthSelect"></select>
    <label>ุงูุชุงุฑูุฎ</label><select id="dateSelect"></select>
    <label>ุงูุงุณู</label>
    <input type="text" id="nameInput" placeholder="ุงูุชุจ ุงูุงุณู...(ูุงุฒู ูู ุงูุงูุชุฑุงุญุงุช)">
    <div id="nameSuggestions" class="suggestions" style="display:none;"></div>
    <label>ุงูุญุถูุฑ</label>
    <div class="radio-group">
      <label><input type="radio" name="attendance" value="ุญุถุฑ"> ุญุถุฑ</label>
      <label><input type="radio" name="attendance" value="ุบุงุจ"> ุบุงุจ</label>
    </div>
    <label>ุฌุงุจ ุงูููุชุฉุ</label>
    <div class="radio-group">
      <label><input type="radio" name="notebook" value="ูุนู"> ูุนู</label>
      <label><input type="radio" name="notebook" value="ูุง"> ูุง</label>
    </div>
    <button id="attendanceSubmit" class="submit-btn" disabled>ุฅุฑุณุงู</button>
  </div>

  <!-- ุชุณุฌูู ุงูุชูุงุนู -->
  <div class="card">
  <h3>ุชุณุฌูู ุงูุชูุงุนู</h3>
  <label>ุงูุงุณู</label>
  <input type="text" id="interactionName" placeholder="ุงูุชุจ ุงูุงุณู...">
  <div id="interactionSuggestions" class="suggestions" style="display:none;"></div>

  <label>ุงูุณูุฉ</label>
<select id="interactionYearSelect"></select>

<label>ุงูุดูุฑ</label>
<select id="interactionMonthSelect"></select>

<label>ุงูููู</label>
<select id="interactionDateSelect"></select>

  <label>ููุงุท ุงูุชูุงุนู (0 - 5)</label>
  <input type="number" id="interactionPoints" min="0" max="5">

  <button id="interactionSubmit" class="submit-btn" disabled>ุฅุฑุณุงู</button>
</div>

    <!-- ุชุณุฌูู ุงูุงูุชูุงุฏ -->
<div class="card">
  <h3>ุชุณุฌูู ุงูุงูุชูุงุฏ</h3>

  <label>ุงูุชุงุฑูุฎ</label>
  <select id="absenceYear"></select>
  <select id="absenceMonth"></select>
  <select id="absenceDate"></select>

  <label>ุงุณู ุงูุทูู</label>
  <input type="text" id="absenceChildName" placeholder="ุงูุชุจ ุงุณู ุงูุทูู...">
  <div id="absenceChildSuggestions" class="suggestions" style="display:none;"></div>

  <label>ุงุณู ุงูุฎุงุฏู</label>
  <select id="absenceStaff">
    <option value="">ุงุฎุชุฑ ุงูุฎุงุฏู</option>
    <option value="ุฌูููุง ุดููุฏุฉ">ุฌูููุง ุดููุฏุฉ</option>
<option value="ูุฑูู ุงููู">ูุฑูู ุงููู</option>
<option value="ุงูููููุง ุญูุง">ุงูููููุง ุญูุง</option>
<option value="ูุฑูุณุชู ุตุจุฑู">ูุฑูุณุชู ุตุจุฑู</option>
<option value="ูุฑูุช ุงุดุฑู">ูุฑูุช ุงุดุฑู</option>
<option value="ุฌุงุณูุชุง ุจููุณ">ุฌุงุณูุชุง ุจููุณ</option>
<option value="ุฌูุณููุง ููุงู">ุฌูุณููุง ููุงู</option>
<option value="ูุฑูู ูุดุฃุช">ูุฑูู ูุดุฃุช</option>
<option value="ูุฑูู ุซุฑูุช">ูุฑูู ุซุฑูุช</option>
<option value="ููุฑููุง ูุงูุฑ">ููุฑููุง ูุงูุฑ</option>
<option value="ุญูุงู ูููุชูุฑ">ุญูุงู ูููุชูุฑ</option>
<option value="ููุงุฑ ูุตูู">ููุงุฑ ูุตูู</option>
<option value="ูุฑูู ูุฑูุณ">ูุฑูู ูุฑูุณ</option>
  </select>

  <label>ููุน ุงูุงูุชูุงุฏ</label>
  <select id="absenceType">
    <option value="ููุฒู">ููุฒู</option>
    <option value="ุชูููููู">ุชูููููู</option>
  </select>

  <label>ุงูููุงุญุธุงุช</label>
  <textarea id="absenceNotes" placeholder="ุงูุชุจ ุงูููุงุญุธุงุช ููุง..." rows="3"></textarea>

  <button id="absenceSubmit" class="submit-btn" disabled>ุฅุฑุณุงู</button>
</div>

    <div class="card">
  <h3>๐ ุชุณุฌูู ูุฏูุฉ ุนูุฏ ูููุงุฏ</h3>

  <label>ุงูุงุณู</label>
  <input type="text" id="giftName" placeholder="ุงูุชุจ ุงูุงุณู...">
  <div id="giftSuggestions" class="suggestions" style="display:none;"></div>

  <label>ูู ุงุณุชูู ูุฏูุฉุ</label>
  <select id="giftReceived">
    <option value="">ุงุฎุชุฑ</option>
    <option value="ูุนู">ูุนู</option>
    <option value="ูุง">ูุง</option>
  </select>

  <label>ุชุงุฑูุฎ ุงูุงุณุชูุงู</label>
  <select id="giftYear"></select>
  <select id="giftMonth"></select>
  <select id="giftDay"></select>

  <label>ุงุณู ุงูุฎุงุฏู</label>
  <select id="giftStaff">
    <option value="">ุงุฎุชุฑ ุงูุฎุงุฏู</option>
    <option value="ุฌูููุง ุดููุฏุฉ">ุฌูููุง ุดููุฏุฉ</option>
<option value="ูุฑูู ุงููู">ูุฑูู ุงููู</option>
<option value="ุงูููููุง ุญูุง">ุงูููููุง ุญูุง</option>
<option value="ูุฑูุณุชู ุตุจุฑู">ูุฑูุณุชู ุตุจุฑู</option>
<option value="ูุฑูุช ุงุดุฑู">ูุฑูุช ุงุดุฑู</option>
<option value="ุฌุงุณูุชุง ุจููุณ">ุฌุงุณูุชุง ุจููุณ</option>
<option value="ุฌูุณููุง ููุงู">ุฌูุณููุง ููุงู</option>
<option value="ูุฑูู ูุดุฃุช">ูุฑูู ูุดุฃุช</option>
<option value="ูุฑูู ุซุฑูุช">ูุฑูู ุซุฑูุช</option>
<option value="ููุฑููุง ูุงูุฑ">ููุฑููุง ูุงูุฑ</option>
<option value="ุญูุงู ูููุชูุฑ">ุญูุงู ูููุชูุฑ</option>
<option value="ููุงุฑ ูุตูู">ููุงุฑ ูุตูู</option>
<option value="ูุฑูู ูุฑูุณ">ูุฑูู ูุฑูุณ</option>
  </select>

  <button id="giftSubmit" class="submit-btn" disabled>๐ ุชุณุฌูู ุงููุฏูุฉ</button>
</div>

</section>

<section id="reportsSection" class="section">
  <!-- ุฃุนูุงุฏ ุงููููุงุฏ -->
  <div class="card">
    <h3>ุฃุนูุงุฏ ูููุงุฏ ุงูุฃุทูุงู</h3>
    <label>ุงุฎุชุฑ ุงูุดูุฑ</label><select id="birthdayMonth"></select>
    <button id="birthdayShow" class="submit-btn">ุนุฑุถ ุงูุฃุณูุงุก</button>
    <div id="birthdayResult"></div>
  </div>

  <!-- ุชูุฑูุฑ ุงูุญุถูุฑ -->
  <div class="card">
    <h3>ุชูุฑูุฑ ุงูุญุถูุฑ</h3>
    <label>ุงูุณูุฉ</label><select id="reportYear"></select>
    <label>ุงูุดูุฑ</label><select id="reportMonth"></select>
    <label>ุงูุชุงุฑูุฎ</label><select id="reportDate"></select>
    <button id="showCount" class="submit-btn">ุนุฏุฏ ุงูุญุถูุฑ</button>
    <button id="showNames" class="submit-btn">ุนุฑุถ ุงูุฃุณูุงุก</button>
    <div id="attendanceReportResult"></div>
  </div>

  <!-- ุจูุงูุงุช ุงูุทูู -->
  <div class="card">
    <h3>ุจูุงูุงุช ุงูุทูู</h3>
    <label>ุงูุงุณู</label><input type="text" id="childInfoName" placeholder="ุงูุชุจ ุงูุงุณู...">
    <div id="childInfoSuggestions" class="suggestions" style="display:none;"></div>
    <button id="showChildInfo" class="submit-btn">ุนุฑุถ ุงูุจูุงูุงุช</button>
    <div id="childInfoResult"></div>
  </div>

  <!-- ุญุถูุฑ ุงูุทูู ูู ุงูุดูุฑ -->
  <div class="card">
    <h3>ุญุถูุฑ ุงูุทูู ูู ุงูุดูุฑ</h3>
    <label>ุงูุงุณู</label><input type="text" id="childAttendanceName" placeholder="ุงูุชุจ ุงูุงุณู...">
    <div id="childAttendanceSuggestions" class="suggestions" style="display:none;"></div>
    <label>ุงูุณูุฉ</label><select id="childAttendanceYear"></select>
    <label>ุงูุดูุฑ</label><select id="childAttendanceMonth"></select>
    <button id="showChildAttendance" class="submit-btn">ุนุฑุถ ุงูุญุถูุฑ</button>
    <div id="childAttendanceResult"></div>
  </div>

  <!-- ููุงุท ุงูุชูุงุนู ุงูุดูุฑูุฉ -->
  <div class="card">
    <h3>ููุงุท ุงูุชูุงุนู ุงูุดูุฑูุฉ</h3>
    <label>ุงูุงุณู</label><input type="text" id="interactionReportName" placeholder="ุงูุชุจ ุงูุงุณู...">
    <div id="interactionReportSuggestions" class="suggestions" style="display:none;"></div>
    <label>ุงูุณูุฉ</label><select id="interactionReportYear"></select>
    <label>ุงูุดูุฑ</label><select id="interactionReportMonth"></select>
    <button id="showInteractionReport" class="submit-btn">ุนุฑุถ ููุงุท ุงูุชูุงุนู</button>
    <div id="interactionReportResult"></div>
  </div>

    <!-- ุชูุฑูุฑ ุงูุงูุชูุงุฏ -->
<div class="card">
  <h3>ุชูุฑูุฑ ุงูุงูุชูุงุฏ</h3>
  <label>ุงุฎุชุฑ ุงูุทูู</label>
  <input type="text" id="absenceReportChildName" placeholder="ุงูุชุจ ุงุณู ุงูุทูู...">
  <div id="absenceReportSuggestions" class="suggestions" style="display:none;"></div>

  <label>ุงุฎุชุฑ ุงูุณูุฉ</label>
  <select id="absenceReportYear"></select>

  <label>ุงุฎุชุฑ ุงูุดูุฑ</label>
  <select id="absenceReportMonth"></select>

  <button id="showAbsenceReport" class="submit-btn">ุนุฑุถ ุชูุฑูุฑ ุงูุงูุชูุงุฏ</button>
  <div id="absenceReportResult"></div>
</div>

    <div class="card">
  <h3>๐ ุชูุฑูุฑ ูุฏุงูุง ุนูุฏ ุงููููุงุฏ</h3>
  <label>ุงูุงุณู</label>
  <input type="text" id="giftReportName" placeholder="ุงูุชุจ ุงูุงุณู...">
  <div id="giftReportSuggestions" class="suggestions" style="display:none;"></div>

  <label>ุงูุณูุฉ</label>
  <select id="giftReportYear"></select>

  <button id="showGiftReport" class="submit-btn">ุนุฑุถ ุงูุชูุฑูุฑ</button>
  <div id="giftReportResult"></div>
</div>

    <div class="card">
  <h3>๐ ุชูุฑูุฑ ุงูุชูุงุฏ ุฎุฏุงู</h3>

  <label>ุงุฎุชุฑ ุงุณู ุงูุฎุงุฏู</label>
  <select id="staffReportName">
    <option value="">ุงุฎุชุฑ ุงูุฎุงุฏู</option>
    <option value="ุฌูููุง ุดููุฏุฉ">ุฌูููุง ุดููุฏุฉ</option>
    <option value="ูุฑูู ุงููู">ูุฑูู ุงููู</option>
    <option value="ุงูููููุง ุญูุง">ุงูููููุง ุญูุง</option>
    <option value="ูุฑูุณุชู ุตุจุฑู">ูุฑูุณุชู ุตุจุฑู</option>
    <option value="ูุฑูุช ุงุดุฑู">ูุฑูุช ุงุดุฑู</option>
    <option value="ุฌุงุณูุชุง ุจููุณ">ุฌุงุณูุชุง ุจููุณ</option>
    <option value="ุฌูุณููุง ููุงู">ุฌูุณููุง ููุงู</option>
    <option value="ูุฑูู ูุดุฃุช">ูุฑูู ูุดุฃุช</option>
    <option value="ูุฑูู ุซุฑูุช">ูุฑูู ุซุฑูุช</option>
    <option value="ููุฑููุง ูุงูุฑ">ููุฑููุง ูุงูุฑ</option>
    <option value="ุญูุงู ูููุชูุฑ">ุญูุงู ูููุชูุฑ</option>
    <option value="ููุงุฑ ูุตูู">ููุงุฑ ูุตูู</option>
    <option value="ูุฑูู ูุฑูุณ">ูุฑูู ูุฑูุณ</option>
  </select>

  <label>ุงูุณูุฉ</label>
  <select id="staffReportYear"></select>

  <label>ุงูุดูุฑ</label>
  <select id="staffReportMonth"></select>

  <button id="showStaffReport" class="submit-btn">ุนุฑุถ ุงูุชูุฑูุฑ</button>
  <div id="staffReportResult"></div>
</div>

</section>

    <section id="addEditSection" class="section">

  <h2>โ๐ป๏ธ ุฅุถุงูุฉ / ุชุนุฏูู ุจูุงูุงุช ุทูู</h2>

  <div id="addEditForm" class="child-form">
    <label>ุงูุงุณู:</label>
    <input id="ae_name" type="text" placeholder="ุงุฏุฎู ุงูุงุณู" list="allNamesList"><br>

    <label>ุงููุฑูุฉ:</label>
<input id="ae_class" type="text" placeholder="ูุซูุงู: ุซุงูุซุฉ ุงุจุชุฏุงุฆู"><br>

<label>ุงููุฌููุนุฉ:</label>
<select id="ae_group">
  <option value="ุงูุจุงุจุง ููุฑูุณ">ุงูุจุงุจุง ููุฑูุณ</option>
  <option value="ูุงุฑูููุง">ูุงุฑูููุง</option>
  <option value="ูุงูุง ุงูุนุฏุฑุง">ูุงูุง ุงูุนุฏุฑุง</option>
</select><br>

  <label>ุงูุณูุฉ:</label>
<select id="ae_year"></select><br>

<label>ุงูุดูุฑ:</label>
<select id="ae_month"></select><br>

<label>ุงูููู:</label>
<select id="ae_day"></select><br>

    <label>ุงููุฏุฑุณุฉ:</label>
    <input id="ae_school" type="text"><br>

    <label>ุงูุณูุฉ ุงูุฏุฑุงุณูุฉ:</label>
    <input id="ae_schoolYear" type="text"><br>

    <label>ุฃุจ ุงูุงุนุชุฑุงู:</label>
    <input id="ae_confession" type="text"><br>

    <label>ุงูููุทูุฉ:</label>
    <input id="ae_area" type="text"><br>

    <label>ุงูุดุงุฑุน:</label>
    <input id="ae_street" type="text"><br>

    <label>ุจุฌูุงุฑ / ุฃุนูู / ุฃูุงู:</label>
    <input id="ae_near" type="text"><br>

    <label>ุฑูู ุงูููุฒู:</label>
    <input id="ae_homeNum" type="text"><br>

    <label>ุชููููู ุงูููุฒู:</label>
    <input id="ae_homePhone" type="text"><br>

    <label>ุชููููู ุงูุฃุจ:</label>
    <input id="ae_fatherPhone" type="text"><br>

    <label>ุนูู ุงูุฃุจ:</label>
    <input id="ae_fatherJob" type="text"><br>

    <label>ุชููููู ุงูุฃู:</label>
    <input id="ae_motherPhone" type="text"><br>

    <label>ุนูู ุงูุฃู:</label>
    <input id="ae_motherJob" type="text"><br>

      <!-- ุงูุฅุฎูุฉ -->
<label>ุงุณู ุงูุฃุฎ 1:</label>
<input id="ae_brother1" type="text"><br>
<label>ุณู ุงูุฃุฎ 1:</label>
<input id="ae_brother1Age" type="number"><br>

<label>ุงุณู ุงูุฃุฎ 2:</label>
<input id="ae_brother2" type="text"><br>
<label>ุณู ุงูุฃุฎ 2:</label>
<input id="ae_brother2Age" type="number"><br>

<label>ุงุณู ุงูุฃุฎ 3:</label>
<input id="ae_brother3" type="text"><br>
<label>ุณู ุงูุฃุฎ 3:</label>
<input id="ae_brother3Age" type="number"><br>

<label>ุงุณู ุงูุฃุฎ 4:</label>
<input id="ae_brother4" type="text"><br>
<label>ุณู ุงูุฃุฎ 4:</label>
<input id="ae_brother4Age" type="number"><br>

<label>ุงุณู ุงูุฃุฎ 5:</label>
<input id="ae_brother5" type="text"><br>
<label>ุณู ุงูุฃุฎ 5:</label>
<input id="ae_brother5Age" type="number"><br>

<!-- ุงูุณูุงุช -->
<label>ูุบุงุช ุงูุญุจ:</label>
<input id="ae_loveLangs" type="text"><br>

<label>ุงูุณูุงุช ุงูุดุฎุตูุฉ:</label>
<input id="ae_traits" type="text"><br>

<label>ุงูููุงูุจ:</label>
<input id="ae_talents" type="text"><br>

<label>ุฃูุถู ุงูุทุฑู ููุชุนุงูู ูุนู:</label>
<input id="ae_bestWays" type="text"><br>

<label>ุงููุดููุงุช:</label>
<input id="ae_problems" type="text"><br>

    <label>ุฑุงุจุท ุงูุตูุฑุฉ (Google Drive):</label>
    <input id="ae_photo" type="text" placeholder="ุถุน ุฑุงุจุท ุงูุตูุฑุฉ ููุง"><br>

    <button id="saveChildBtn">๐พ ุญูุธ ุงูุจูุงูุงุช</button>
  </div>

  <div id="addEditResult" style="margin-top:15px; font-weight:bold;"></div>

        <div class="card">
  <h3>๐ ุชุนุฏูู / ุฅุถุงูุฉ ุญุถูุฑ</h3>
  <label>ุงูุงุณู:</label><input id="ae_att_name" type="text"><br>
  <label>ุงูุณูุฉ:</label><select id="ae_att_year"></select>
  <label>ุงูุดูุฑ:</label><select id="ae_att_month"></select>
  <label>ุงูููู:</label><select id="ae_att_day"></select>
  <label>ุงูุญุถูุฑ:</label>
  <div class="radio-group">
    <label><input type="radio" name="ae_att_status" value="ุญุถุฑ"> ุญุถุฑ</label>
    <label><input type="radio" name="ae_att_status" value="ุบุงุจ"> ุบุงุจ</label>
  </div>
  <label>ุฌุงุจ ุงูููุชุฉุ</label>
  <div class="radio-group">
    <label><input type="radio" name="ae_att_notebook" value="ูุนู"> ูุนู</label>
    <label><input type="radio" name="ae_att_notebook" value="ูุง"> ูุง</label>
  </div>
  <button id="ae_att_btn" class="submit-btn">๐พ ุญูุธ ุงูุญุถูุฑ</button>
</div>

<div class="card">
  <h3>โจ ุชุนุฏูู / ุฅุถุงูุฉ ุชูุงุนู</h3>
  <label>ุงูุงุณู:</label><input id="ae_interact_name" type="text"><br>
  <label>ุงูุณูุฉ:</label><select id="ae_interact_year"></select>
  <label>ุงูุดูุฑ:</label><select id="ae_interact_month"></select>
  <label>ุงูููู:</label><select id="ae_interact_day"></select>
  <label>ููุงุท ุงูุชูุงุนู (0 - 5):</label><input id="ae_interact_points" type="number" min="0" max="5"><br>
  <button id="ae_interact_btn" class="submit-btn">๐พ ุญูุธ ุงูุชูุงุนู</button>
</div>

<div class="card">
  <h3>๐ ุชุนุฏูู / ุฅุถุงูุฉ ุงูุชูุงุฏ</h3>
  <label>ุงูุงุณู:</label><input id="ae_abs_name" type="text"><br>
  <label>ุงูุณูุฉ:</label>
<select id="ae_abs_year"></select><br>

<label>ุงูุดูุฑ:</label>
<select id="ae_abs_month"></select><br>

<label>ุงูููู:</label>
<select id="ae_abs_day"></select><br>

  <label>ููุน ุงูุงูุชูุงุฏ:</label>
  <select id="ae_abs_type">
    <option value="ููุฒู">ููุฒู</option>
    <option value="ุชูููููู">ุชูููููู</option>
  </select>
  <label>ุงุณู ุงูุฎุงุฏู:</label>
  <select id="ae_abs_staff">
    <option value="ุฌูููุง ุดููุฏุฉ">ุฌูููุง ุดููุฏุฉ</option>
<option value="ูุฑูู ุงููู">ูุฑูู ุงููู</option>
<option value="ุงูููููุง ุญูุง">ุงูููููุง ุญูุง</option>
<option value="ูุฑูุณุชู ุตุจุฑู">ูุฑูุณุชู ุตุจุฑู</option>
<option value="ูุฑูุช ุงุดุฑู">ูุฑูุช ุงุดุฑู</option>
<option value="ุฌุงุณูุชุง ุจููุณ">ุฌุงุณูุชุง ุจููุณ</option>
<option value="ุฌูุณููุง ููุงู">ุฌูุณููุง ููุงู</option>
<option value="ูุฑูู ูุดุฃุช">ูุฑูู ูุดุฃุช</option>
<option value="ูุฑูู ุซุฑูุช">ูุฑูู ุซุฑูุช</option>
<option value="ููุฑููุง ูุงูุฑ">ููุฑููุง ูุงูุฑ</option>
<option value="ุญูุงู ูููุชูุฑ">ุญูุงู ูููุชูุฑ</option>
<option value="ููุงุฑ ูุตูู">ููุงุฑ ูุตูู</option>
<option value="ูุฑูู ูุฑูุณ">ูุฑูู ูุฑูุณ</option>
  </select>
  <label>ููุงุญุธุงุช:</label><textarea id="ae_abs_notes" rows="3"></textarea>
  <button id="ae_abs_btn" class="submit-btn">๐พ ุญูุธ ุงูุงูุชูุงุฏ</button>
</div>

        <div class="card">
  <h3>๐๏ธ ุชุนุฏูู ุจูุงูุงุช ูุฎุชุงุฑุฉ ูุทูู</h3>

  <label>ุงูุงุณู:</label>
  <input type="text" id="editChildName" placeholder="ุงูุชุจ ุงูุงุณู..." />
  <div id="editChildSuggestions" class="suggestions" style="display:none;"></div>

  <label>ุงุฎุชุฑ ุงูุจูุงูุงุช ุงููุฑุงุฏ ุชุนุฏูููุง:</label>
  <select id="editField">
    <option value="">ุงุฎุชุฑ ุงูุญูู</option>
    <option value="class">ุงููุฑูุฉ</option>
    <option value="day">ุงูููู</option>
    <option value="month">ุงูุดูุฑ</option>
    <option value="year">ุงูุณูุฉ</option>
    <option value="school">ุงููุฏุฑุณุฉ</option>
    <option value="schoolYear">ุงูุณูุฉ ุงูุฏุฑุงุณูุฉ</option>
    <option value="confession">ุฃุจ ุงูุงุนุชุฑุงู</option>
    <option value="area">ุงูููุทูุฉ</option>
    <option value="street">ุงูุดุงุฑุน</option>
    <option value="near">ุจุฌูุงุฑ / ุฃุนูู / ุฃูุงู</option>
    <option value="homeNum">ุฑูู ุงูููุฒู</option>
    <option value="homePhone">ุชููููู ุงูููุฒู</option>
    <option value="fatherPhone">ุชููููู ุงูุฃุจ</option>
    <option value="fatherJob">ุนูู ุงูุฃุจ</option>
    <option value="motherPhone">ุชููููู ุงูุฃู</option>
    <option value="motherJob">ุนูู ุงูุฃู</option>
    <option value="brother1">ุงุณู ุงูุฃุฎ 1</option>
    <option value="brother1Age">ุณู ุงูุฃุฎ 1</option>
    <option value="brother2">ุงุณู ุงูุฃุฎ 2</option>
    <option value="brother2Age">ุณู ุงูุฃุฎ 2</option>
    <option value="brother3">ุงุณู ุงูุฃุฎ 3</option>
    <option value="brother3Age">ุณู ุงูุฃุฎ 3</option>
    <option value="brother4">ุงุณู ุงูุฃุฎ 4</option>
    <option value="brother4Age">ุณู ุงูุฃุฎ 4</option>
    <option value="brother5">ุงุณู ุงูุฃุฎ 5</option>
    <option value="brother5Age">ุณู ุงูุฃุฎ 5</option>
    <option value="loveLangs">ูุบุงุช ุงูุญุจ</option>
    <option value="traits">ุงูุณูุงุช ุงูุดุฎุตูุฉ</option>
    <option value="talents">ุงูููุงูุจ</option>
    <option value="bestWays">ุฃูุถู ุงูุทุฑู ููุชุนุงูู ูุนู</option>
    <option value="problems">ุงููุดููุงุช</option>
    <option value="photo">ุฑุงุจุท ุงูุตูุฑุฉ</option>
    <option value="group">ููุฏ ุงููุฌููุนุฉ (group)</option>
  </select>

  <label>ุงููููุฉ ุงูุฌุฏูุฏุฉ:</label>
  <input type="text" id="editNewValue" placeholder="ุงูุชุจ ุงูุชุนุฏูู ููุง..." />

  <button id="editChildBtn" class="submit-btn">๐พ ุญูุธ ุงูุชุนุฏูู</button>
</div>

</main>

<script>
    let userGroups = [];
const apiURL="https://3rd.johnmamdouh777.workers.dev/";
const currentYear = new Date().getFullYear();
const months=["ููุงูุฑ","ูุจุฑุงูุฑ","ูุงุฑุณ","ุฃุจุฑูู","ูุงูู","ููููู","ููููู","ุฃุบุณุทุณ","ุณุจุชูุจุฑ","ุฃูุชูุจุฑ","ููููุจุฑ","ุฏูุณูุจุฑ"];
fillYearSelect(document.getElementById("absenceYear"));
fillMonthSelect(document.getElementById("absenceMonth"));
fillYearSelect(document.getElementById("absenceReportYear"));
fillYearSelect(document.getElementById("giftReportYear"), 2020, currentYear + 1);

// --- ุงูุชููู ุจูู ุงูุฃูุณุงู ---
document.getElementById("attendanceTab").onclick = () => {
  document.getElementById("attendanceSection").classList.add("active");
  document.getElementById("reportsSection").classList.remove("active");
  document.getElementById("addEditSection").classList.remove("active");

  document.getElementById("attendanceTab").classList.add("active");
  document.getElementById("reportsTab").classList.remove("active");
  document.getElementById("addEditTab").classList.remove("active");
};

document.getElementById("reportsTab").onclick = () => {
  document.getElementById("attendanceSection").classList.remove("active");
  document.getElementById("reportsSection").classList.add("active");
  document.getElementById("addEditSection").classList.remove("active");

  document.getElementById("attendanceTab").classList.remove("active");
  document.getElementById("reportsTab").classList.add("active");
  document.getElementById("addEditTab").classList.remove("active");
};

document.getElementById("addEditTab").onclick = () => {
  document.getElementById("attendanceSection").classList.remove("active");
  document.getElementById("reportsSection").classList.remove("active");
  document.getElementById("addEditSection").classList.add("active");

  document.getElementById("attendanceTab").classList.remove("active");
  document.getElementById("reportsTab").classList.remove("active");
  document.getElementById("addEditTab").classList.add("active");
};
    
// --- ุชุนุจุฆุฉ ุงูุณููุงุช ูุงูุดููุฑ ---
function fillYearSelect(sel, start = currentYear - 1, end = currentYear + 1){
  if (!sel) return;
  sel.innerHTML = "";
  for (let y = start; y <= end; y++) {
    const opt = document.createElement("option");
    opt.value = y;
    opt.textContent = y;
    sel.appendChild(opt);
  }
}

fillYearSelect(document.getElementById("yearSelect"));
fillYearSelect(document.getElementById("reportYear"));
fillYearSelect(document.getElementById("childAttendanceYear"));
fillYearSelect(document.getElementById("interactionReportYear"));
fillYearSelect(document.getElementById("absenceReportYear"));
fillYearSelect(document.getElementById("giftReportYear"), 2020, currentYear + 1);
fillYearSelect(document.getElementById("staffReportYear"));
fillMonthSelect(document.getElementById("staffReportMonth"));

function fillMonthSelect(sel){
  if(!sel) return;
  sel.innerHTML = ""; // ุฅุฒุงูุฉ ุฃู ุฎูุงุฑุงุช ููุฌูุฏุฉ
  months.forEach((m,i)=>{
    const opt = document.createElement("option");
    opt.value = i+1;
    opt.textContent = m;
    sel.appendChild(opt);
  });
}


fillMonthSelect(document.getElementById("monthSelect"));
fillMonthSelect(document.getElementById("reportMonth"));
fillMonthSelect(document.getElementById("childAttendanceMonth"));
fillMonthSelect(document.getElementById("interactionReportMonth"));
fillMonthSelect(document.getElementById("birthdayMonth"));
fillMonthSelect(document.getElementById("absenceReportMonth"));
    fillYearSelect(document.getElementById("giftYear"));
fillMonthSelect(document.getElementById("giftMonth"));
fillAllDays(document.getElementById("giftYear"), document.getElementById("giftMonth"), document.getElementById("giftDay"));

document.getElementById("giftYear").onchange = () => {
  fillAllDays(document.getElementById("giftYear"), document.getElementById("giftMonth"), document.getElementById("giftDay"));
};
document.getElementById("giftMonth").onchange = () => {
  fillAllDays(document.getElementById("giftYear"), document.getElementById("giftMonth"), document.getElementById("giftDay"));
};


// --- ุชุนุจุฆุฉ ุฃูุงู ุงูุฌูุนุฉ ---
function fillFridays(yearSel, monthSel, dateSel){
  if (!yearSel || !monthSel || !dateSel) return; // ุญูุงูุฉ ูู null
  dateSel.innerHTML = "";
  const year = +yearSel.value;
  const month = +monthSel.value - 1;
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  for(let d = 1; d <= daysInMonth; d++){
    const date = new Date(year, month, d);
    if(date.getDay() === 5){
      const opt = document.createElement("option");
      opt.value = d;
      opt.textContent = `${d}/${month + 1}/${year}`;
      dateSel.appendChild(opt);
    }
  }
}

fillFridays(document.getElementById("yearSelect"), document.getElementById("monthSelect"), document.getElementById("dateSelect"));
document.getElementById("yearSelect").onchange = () => fillFridays(document.getElementById("yearSelect"), document.getElementById("monthSelect"), document.getElementById("dateSelect"));
document.getElementById("monthSelect").onchange = () => fillFridays(document.getElementById("yearSelect"), document.getElementById("monthSelect"), document.getElementById("dateSelect"));

// --- ุชุญููู ุงูุฃุณูุงุก ---
let allNames = [];

async function loadNames(groups = userGroups){
  if (!groups || groups.length === 0) return;
  try{
    const res = await fetch(apiURL+"?type=names&groups=" + groups.join(","));
    const data = await res.json();
    allNames = Array.isArray(data) ? data : (data.names || []);
  } catch(err){ 
    console.warn(err); 
  }
}

const nameInput = document.getElementById("nameInput");
const interactionName = document.getElementById("interactionName");
const childInfoName = document.getElementById("childInfoName");
const childAttendanceName = document.getElementById("childAttendanceName");
const interactionReportName = document.getElementById("interactionReportName");

// ุงุฎุชุฑ ููุงู ุชูููุฐ ุงูุชุญููู ููุท ูุฑุฉ:
async function initAttendance(){
  await loadNames(); // โฌ๏ธ ุถุฑูุฑู ุฌุฏูุง ุชุญููู ุงูุฃุณูุงุก ููุง

  setupSuggestions(nameInput, document.getElementById("nameSuggestions"));
  setupSuggestions(interactionName, document.getElementById("interactionSuggestions"));
  setupSuggestions(childInfoName, document.getElementById("childInfoSuggestions"));
  setupSuggestions(childAttendanceName, document.getElementById("childAttendanceSuggestions"));
  setupSuggestions(interactionReportName, document.getElementById("interactionReportSuggestions"));
  setupSuggestions(document.getElementById("absenceChildName"), document.getElementById("absenceChildSuggestions"));
  setupSuggestions(document.getElementById("absenceReportChildName"), document.getElementById("absenceReportSuggestions"));
  setupSuggestions(document.getElementById("giftName"), document.getElementById("giftSuggestions"));
  setupSuggestions(document.getElementById("giftReportName"), document.getElementById("giftReportSuggestions"));
  setupSuggestions(document.getElementById("editChildName"), document.getElementById("editChildSuggestions"));
  checkAttendanceReady();
}

initAttendance();

// --- ุงูุงูุชุฑุงุญุงุช ---
function setupSuggestions(inputEl, suggestionsEl){
  inputEl.addEventListener("input",()=>{
    const q=inputEl.value.trim().toLowerCase();
    if(!q) return suggestionsEl.style.display="none";
    const filtered=allNames.filter(n=>n.toLowerCase().includes(q)).slice(0,10);
    if(filtered.length===0){ suggestionsEl.style.display="none"; return; }
    suggestionsEl.innerHTML="";
    filtered.forEach(name=>{
      const div=document.createElement("div");
      div.textContent=name;
      div.onclick=()=>{
        inputEl.value=name;
        suggestionsEl.style.display="none";
        inputEl.dispatchEvent(new Event("input"));
      };
      suggestionsEl.appendChild(div);
    });
    suggestionsEl.style.display="block";
  });
  document.addEventListener("click",(e)=>{
    if(!inputEl.contains(e.target)&&!suggestionsEl.contains(e.target))
      suggestionsEl.style.display="none";
  });
}
setupSuggestions(document.getElementById("nameInput"),document.getElementById("nameSuggestions"));
setupSuggestions(document.getElementById("interactionName"),document.getElementById("interactionSuggestions"));
setupSuggestions(document.getElementById("childInfoName"),document.getElementById("childInfoSuggestions"));
setupSuggestions(document.getElementById("childAttendanceName"),document.getElementById("childAttendanceSuggestions"));
setupSuggestions(document.getElementById("interactionReportName"),document.getElementById("interactionReportSuggestions"));

    const absenceSubmit = document.getElementById("absenceSubmit");
    const giftNameInput = document.getElementById("giftName");
const giftReceivedSelect = document.getElementById("giftReceived");
const giftYearSelect = document.getElementById("giftYear");
const giftMonthSelect = document.getElementById("giftMonth");
const giftDaySelect = document.getElementById("giftDay");
const giftStaffSelect = document.getElementById("giftStaff");
const giftSubmit = document.getElementById("giftSubmit");
const absenceChildNameInput = document.getElementById("absenceChildName");
const absenceStaffSelect = document.getElementById("absenceStaff");

    function checkGiftReady() {
  const nameValid = allNames.includes(giftNameInput.value.trim());
  const receivedSelected = giftReceivedSelect.value !== "";
  const yearSelected = giftYearSelect.value !== "";
  const monthSelected = giftMonthSelect.value !== "";
  const daySelected = giftDaySelect.value !== "";
  const staffSelected = giftStaffSelect.value !== "";

  giftSubmit.disabled = !(nameValid && receivedSelected && yearSelected && monthSelected && daySelected && staffSelected);
}

    giftNameInput.addEventListener("input", checkGiftReady);
giftReceivedSelect.addEventListener("change", checkGiftReady);
giftYearSelect.addEventListener("change", checkGiftReady);
giftMonthSelect.addEventListener("change", checkGiftReady);
giftDaySelect.addEventListener("change", checkGiftReady);
giftStaffSelect.addEventListener("change", checkGiftReady);

function checkAbsenceReady() {
  const nameValid = allNames.includes(absenceChildNameInput.value.trim());
  const staffSelected = absenceStaffSelect.value !== "";
  absenceSubmit.disabled = !(nameValid && staffSelected);
}

absenceChildNameInput.addEventListener("input", checkAbsenceReady);
absenceStaffSelect.addEventListener("change", checkAbsenceReady);
checkAbsenceReady();

    absenceSubmit.addEventListener("click", async () => {
  const name = absenceChildNameInput.value.trim();
  const year = document.getElementById("absenceYear").value;
  const month = document.getElementById("absenceMonth").value;
  const date = document.getElementById("absenceDate").value;
  const staff = absenceStaffSelect.value;
  const type = document.getElementById("absenceType").value;
  const notes = document.getElementById("absenceNotes").value.trim();

  absenceSubmit.disabled = true;

  try {
    const res = await fetch(apiURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        type: "absence",
        name, year, month, date,
        serverName: staff, absenceType: type, notes
      })
    });
    const result = await res.json();
    if(result.success){
      alert("โ ุชู ุชุณุฌูู ุงูุงูุชูุงุฏ ุจูุฌุงุญ!");
      absenceChildNameInput.value = "";
      absenceStaffSelect.value = "";
      document.getElementById("absenceNotes").value = "";
      checkAbsenceReady();
    } else {
      alert("โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุณุฌูู.");
    }
  } catch {
    alert("โ๏ธ ูู ูุชู ุงูุงุชุตุงู ุจุงูุฎุงุฏู.");
  } finally {
    absenceSubmit.disabled = false;
  }
});

// --- ุชูุนูู ุฒุฑ ุงูุญุถูุฑ ---
const attendanceRadios = document.querySelectorAll('input[name="attendance"]');
const notebookRadios = document.querySelectorAll('input[name="notebook"]');
const attendanceSubmit = document.getElementById("attendanceSubmit");

function checkAttendanceReady(){
  const validName = allNames.includes(nameInput.value.trim());
  const attendanceChecked = Array.from(attendanceRadios).some(r=>r.checked);
  const notebookChecked = Array.from(notebookRadios).some(r=>r.checked);
  attendanceSubmit.disabled = !(validName && attendanceChecked && notebookChecked);
}
nameInput.addEventListener("input", checkAttendanceReady);
attendanceRadios.forEach(r=>r.addEventListener("change", checkAttendanceReady));
notebookRadios.forEach(r=>r.addEventListener("change", checkAttendanceReady));
checkAttendanceReady();

// --- ุฅุฑุณุงู ุงูุญุถูุฑ ---
attendanceSubmit.addEventListener("click", async ()=>{
  const name=nameInput.value.trim();
  const attendance=document.querySelector('input[name="attendance"]:checked').value;
  const notebook=document.querySelector('input[name="notebook"]:checked').value;
  const year=document.getElementById("yearSelect").value;
  const month=document.getElementById("monthSelect").value;
  const date=document.getElementById("dateSelect").value;

  // --- ุชุญูู ูุณุจู ููุชุฃูุฏ ูู ุนุฏู ุชูุฑุงุฑ ุงูุญุถูุฑ ---
try {
  const checkRes = await fetch(`${apiURL}?type=checkAttendance&name=${encodeURIComponent(name)}&year=${year}&month=${month}&date=${encodeURIComponent(date)}`);
  const checkData = await checkRes.json();
  if(checkData.exists) {
    alert(`โ ูุง ูููู ุชุณุฌูู ุงูุญุถูุฑ ูุฑุฉ ุซุงููุฉ: ${name}`);
    return; // ุชููู ุงูุชูููุฐ ููุง
  }
} catch {
  alert("โ๏ธ ูู ูุชู ุงูุงุชุตุงู ุจุงูุฎุงุฏู ููุชุญูู ูู ุงูุญุถูุฑ.");
  return;
}

  attendanceSubmit.disabled=true;
  const data={ type:"attendance", year, month, date, name, attendance, notebook };
  try{
    const res=await fetch(apiURL, { method:"POST", headers:{ "Content-Type":"application/json" }, body:JSON.stringify(data) });
    const result=await res.json();
    if(result.success){
      alert("โ ุชู ุชุณุฌูู ุงูุญุถูุฑ ุจูุฌุงุญ!");
      nameInput.value="";
      attendanceRadios.forEach(r=>r.checked=false);
      notebookRadios.forEach(r=>r.checked=false);
      checkAttendanceReady();
    }else alert("โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุณุฌูู.");
  }catch{ alert("โ๏ธ ูู ูุชู ุงูุงุชุตุงู ุจุงูุฎุงุฏู."); }
  finally{ attendanceSubmit.disabled=false; }
});

// --- ุชูุนูู ุฒุฑ ุงูุชูุงุนู ---
const interactionPoints=document.getElementById("interactionPoints");
const interactionSubmit=document.getElementById("interactionSubmit");

function checkInteractionReady(){
  const name=interactionName.value.trim();
  const points=Number(interactionPoints.value);
  const validName=allNames.includes(name);
  const validPoints=!isNaN(points) && points>=0 && points<=5;
  interactionSubmit.disabled=!(name && validPoints && validName);
}
interactionName.addEventListener("input", checkInteractionReady);
interactionPoints.addEventListener("input", checkInteractionReady);
checkInteractionReady();

// --- ุฅุฑุณุงู ุงูุชูุงุนู ---
// --- ุฅุฑุณุงู ุงูุชูุงุนู ูุน ุชุญูู ูู ุงูุชูุฑุงุฑ ---
interactionSubmit.addEventListener("click", async ()=> {
  const name = interactionName.value.trim();
  const year = Number(document.getElementById("interactionYearSelect").value);
  const month = Number(document.getElementById("interactionMonthSelect").value);
  const date = Number(document.getElementById("interactionDateSelect").value);
  const points = Number(interactionPoints.value);

  if(!name || !date || !month || !year || isNaN(points) || points < 0 || points > 5){
    return alert("ุชุฃูุฏ ูู ุฅุฏุฎุงู ุงูุงุณู ูุงูุชุงุฑูุฎ ูุงูููุงุท ุจุดูู ุตุญูุญ");
  }

  // โ ุชุญูู ูุณุจู ูู ุงูุชูุฑุงุฑ ูุจู ุงูุฅุฑุณุงู
  try {
    const checkRes = await fetch(`${apiURL}?type=checkInteraction&name=${encodeURIComponent(name)}&year=${year}&month=${month}&day=${date}`);
    const checkData = await checkRes.json();
    if (checkData.exists) {
      alert(`โ ูุง ูููู ุฅุถุงูุฉ ููุงุท ุชูุงุนู ูููุณ ุงูููู ูุฑุฉ ุฃุฎุฑู (${name})`);
      return; // ููู ุงูุชูููุฐ ููุง
    }
  } catch {
    alert("โ๏ธ ูู ูุชู ุงูุงุชุตุงู ุจุงูุฎุงุฏู ููุชุญูู ูู ุงูุชูุฑุงุฑ.");
    return;
  }

  interactionSubmit.disabled = true;

  try {
    const res = await fetch(apiURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        type: "interaction",
        name,
        date,
        month,
        year,
        points
      })
    });
    const result = await res.json();
    if(result.success){
      alert("โ ุชู ุชุณุฌูู ุงูุชูุงุนู ุจูุฌุงุญ!");
      interactionName.value = "";
      interactionPoints.value = "";
      checkInteractionReady();
    } else {
      alert("โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุณุฌูู.");
    }
  } catch {
    alert("โ๏ธ ูู ูุชู ุงูุงุชุตุงู ุจุงูุฎุงุฏู.");
  } finally {
    interactionSubmit.disabled = false;
  }
});

// --- ุฏูุงู ุนุฑุถ ุงูุฌุฏุงูู ---
function renderListAsTable(container, arr, colName="ุงูุงุณู"){
  if(!arr || arr.length===0){ container.innerHTML="ูุง ุชูุฌุฏ ุจูุงูุงุช"; return; }
  container.innerHTML = `<table><tr><th>${colName}</th></tr>` + arr.map(x=>`<tr><td>${x}</td></tr>`).join("") + "</table>";
}
function renderObjectAsTable(container, obj){
  if(!obj || Object.keys(obj).length===0){ container.innerHTML="ูุง ุชูุฌุฏ ุจูุงูุงุช"; return; }
  container.innerHTML = `<table>` + Object.entries(obj).map(([k,v])=>`<tr><th>${k}</th><td>${v}</td></tr>`).join("") + `</table>`;
}
function renderArrayOfObjectsAsTable(container, arr, headers){
  if(!arr || arr.length===0){ container.innerHTML="ูุง ุชูุฌุฏ ุจูุงูุงุช"; return; }
  container.innerHTML = `<table><tr>${headers.map(h=>`<th>${h}</th>`).join("")}</tr>` +
    arr.map(row=>`<tr>${headers.map(h=>`<td>${row[h]||""}</td>`).join("")}</tr>`).join("") + `</table>`;
}
  // --- ุฃุนูุงุฏ ุงููููุงุฏ ---
document.getElementById("birthdayShow").addEventListener("click", async () => {
  const monthIndex = document.getElementById("birthdayMonth").value; // ุฏู ุฑูู ุงูุดูุฑ 1-12
  const container = document.getElementById("birthdayResult");
  container.innerHTML = "ุฌุงุฑู ุงูุชุญููู...";
  try {
    const res = await fetch(`${apiURL}?type=birthdaysReport&month=${monthIndex}`);
    const data = await res.json();
    // ููุง ูุนุฑุถ ุงููุชุงุฆุฌ ูู ุฌุฏูู
    if(data.records && data.records.length > 0){
      container.innerHTML = `<table><tr><th>ุงุณู ุงูุทูู</th><th>ุงูููู</th><th>ุงูุดูุฑ</th><th>ุงูุณูุฉ</th></tr>` +
        data.records.map(r=>`<tr><td>${r.name}</td><td>${r.day}</td><td>${r.month}</td><td>${r.year}</td></tr>`).join("") +
        `</table>`;
    } else {
      container.innerHTML = "ูุง ุชูุฌุฏ ุจูุงูุงุช ููุฐุง ุงูุดูุฑ";
    }
  } catch (err) {
    console.error(err);
    container.innerHTML = "โ ูู ูุชู ุงูุงุชุตุงู ุจุงูุฎุงุฏู.";
  }
});

    giftSubmit.addEventListener("click", async () => {
  const name = giftNameInput.value.trim();
  const received = giftReceivedSelect.value;
  const year = giftYearSelect.value;
  const month = giftMonthSelect.value;
  const day = giftDaySelect.value;
  const staff = giftStaffSelect.value;

  giftSubmit.disabled = true;

  try {
    const res = await fetch(apiURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        type: "gift",
        name,
        received,
        year,
        month,
        day,
        staff
      })
    });
    const result = await res.json();
    if (result.success) {
      alert("โ ุชู ุชุณุฌูู ุงููุฏูุฉ ุจูุฌุงุญ!");
giftNameInput.value = "";
checkGiftReady(); // ุนูุดุงู ุงูุฒุฑ ูุชููู ุชุงูู ุจุนุฏ ุงูุชูุฑูุบ
    } else {
      alert("โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุณุฌูู.");
    }
  } catch {
    alert("โ๏ธ ูู ูุชู ุงูุงุชุตุงู ุจุงูุฎุงุฏู.");
  } finally {
    giftSubmit.disabled = false;
  }
});

// --- ุชูุฑูุฑ ุงูุญุถูุฑ ---
document.getElementById("showCount").addEventListener("click", async () => {
  const year = document.getElementById("reportYear").value;
  const month = document.getElementById("reportMonth").value;
  const date = document.getElementById("reportDate").value;
  const container = document.getElementById("attendanceReportResult");
  container.innerHTML = "ุฌุงุฑู ุงูุชุญููู...";
  try {
    const res = await fetch(`${apiURL}?type=attendanceCount&year=${year}&month=${month}&date=${date}`);
    const data = await res.json();
    container.innerHTML = `ุนุฏุฏ ุงูุญุถูุฑ: ${data.count || 0}`;
  } catch {
    container.innerHTML = "โ ูู ูุชู ุงูุงุชุตุงู ุจุงูุฎุงุฏู.";
  }
});

document.getElementById("showNames").addEventListener("click", async () => {
  const year = document.getElementById("reportYear").value;
  const month = document.getElementById("reportMonth").value;
  const date = document.getElementById("reportDate").value;
  const container = document.getElementById("attendanceReportResult");
  container.innerHTML = "ุฌุงุฑู ุงูุชุญููู...";
  try {
    const res = await fetch(`${apiURL}?type=attendanceNames&year=${year}&month=${month}&date=${date}`);
    const data = await res.json();
    renderListAsTable(container, data.names || [], "ุงุณู ุงูุทูู");
  } catch {
    container.innerHTML = "โ ูู ูุชู ุงูุงุชุตุงู ุจุงูุฎุงุฏู.";
  }
});

// --- ุจูุงูุงุช ุงูุทูู ---
document.getElementById("showChildInfo").addEventListener("click", async () => {
  const name = document.getElementById("childInfoName").value.trim();
  const container = document.getElementById("childInfoResult");
  if(!name){ container.innerHTML="โ ุงูุชุจ ุงูุงุณู ุฃูููุง"; return; }
  container.innerHTML = "โณ ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...";
  try {
    const res = await fetch(`${apiURL}?type=childInfo&name=${encodeURIComponent(name)}`);
    const data = await res.json();
    if (data && data.records && data.records.length > 0) {
  const record = data.records[0];
  let infoHtml = `<div class="child-info-table"><table>`;
  for (const [key, value] of Object.entries(record)) {
  let displayKey = key;
  let displayValue = value;

  if (key === "group") {
  displayKey = "ุงุณู ุงููุฌููุนุฉ";
  displayValue = value; // โ ูุฃู ุงููููุฉ ุจูุช ุงูุงุณู ูุจุงุดุฑุฉ
}
  if (key === "ุงูุตูุฑุฉ" && value.includes("drive.google.com")) {
  const imgSrc = convertDriveLinkToImageURL(value);
  infoHtml += `<tr><th>${displayKey}</th><td style="width:220px;height:220px;"><img src="${imgSrc}" alt="ุตูุฑุฉ ุงูุทูู" style="max-width:100%;max-height:100%;border-radius:10px;"></td></tr>`;
} else {
    infoHtml += `<tr><th>${displayKey}</th><td>${displayValue}</td></tr>`;
  }
}
      infoHtml += `</table></div>`;
      container.innerHTML = infoHtml;
    } else {
      container.innerHTML = "โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ููุฐุง ุงูุงุณู.";
    }
  } catch (err) {
    container.innerHTML = "โ๏ธ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงูุจูุงูุงุช.";
    console.error(err);
  }
});

// --- ุญุถูุฑ ุงูุทูู ูู ุงูุดูุฑ ---
document.getElementById("showChildAttendance").addEventListener("click", async () => {
  const name = document.getElementById("childAttendanceName").value.trim();
  const year = document.getElementById("childAttendanceYear").value;
  const month = document.getElementById("childAttendanceMonth").value;
  const container = document.getElementById("childAttendanceResult");
  if(!name) return alert("ุงุฏุฎู ุงุณู ุงูุทูู");
  container.innerHTML = "ุฌุงุฑู ุงูุชุญููู...";
  try {
    const res = await fetch(`${apiURL}?type=childAttendance&name=${encodeURIComponent(name)}&year=${year}&month=${month}`);
    const data = await res.json();
    renderArrayOfObjectsAsTable(container, data.records || [], ["date", "attendance", "notebook"]);
  } catch {
    container.innerHTML = "โ ูู ูุชู ุงูุงุชุตุงู ุจุงูุฎุงุฏู.";
  }
});

// --- ููุงุท ุงูุชูุงุนู ุงูุดูุฑูุฉ ---
document.getElementById("showInteractionReport").addEventListener("click", async () => {
  const name = document.getElementById("interactionReportName").value.trim();
  const year = document.getElementById("interactionReportYear").value;
  const month = document.getElementById("interactionReportMonth").value;
  const container = document.getElementById("interactionReportResult");
  if(!name) return alert("ุงุฏุฎู ุงุณู ุงูุทูู");
  container.innerHTML = "ุฌุงุฑู ุงูุชุญููู...";
  try {
    const res = await fetch(`${apiURL}?type=interactionReport&name=${encodeURIComponent(name)}&year=${year}&month=${month}`);
    const data = await res.json();
    const records = data.records || [];
renderArrayOfObjectsAsTable(container, records, ["date", "points"]);

const totalPoints = records.reduce((sum, r) => sum + Number(r.points || 0), 0);
const totalDiv = document.createElement("div");
totalDiv.style.marginTop = "10px";
totalDiv.style.fontWeight = "bold";
totalDiv.textContent = `โ ูุฌููุน ุงูููุงุท: ${totalPoints}`;
container.appendChild(totalDiv);
  } catch {
    container.innerHTML = "โ ูู ูุชู ุงูุงุชุตุงู ุจุงูุฎุงุฏู.";
  }
});

  function fillFridaysForReport(){
  const yearSel = document.getElementById("reportYear");
  const monthSel = document.getElementById("reportMonth");
  const dateSel = document.getElementById("reportDate");
  dateSel.innerHTML = "";
  const year = +yearSel.value;
  const month = +monthSel.value - 1;
  const daysInMonth = new Date(year, month+1, 0).getDate();
  for(let d=1; d<=daysInMonth; d++){
    const date = new Date(year, month, d);
    if(date.getDay() === 5){ // ุฌูุนู
      const opt = document.createElement("option");
      opt.value = d;
      opt.textContent = `${d}/${month+1}/${year}`;
      dateSel.appendChild(opt);
    }
  }
}

// ุฑุจุทูุง ูุน ุชุบููุฑ ุงูุณูุฉ ูุงูุดูุฑ
document.getElementById("reportYear").onchange = fillFridaysForReport;
document.getElementById("reportMonth").onchange = fillFridaysForReport;

// ุงุณุชุฏุนุงุก ุนูุฏ ุชุญููู ุงูุตูุญุฉ
fillFridaysForReport();

    // ุชุนุจุฆุฉ ุงูุณููุงุช ููุดููุฑ ุงูุฎุงุตุฉ ุจุงูุชูุงุนู
fillYearSelect(document.getElementById("interactionYearSelect"));

// ุชุนุจุฆุฉ ุงูุดููุฑ ููุดููุฑ ุงูุฎุงุตุฉ ุจุงูุชูุงุนู
fillMonthSelect(document.getElementById("interactionMonthSelect"));
    
    function fillInteractionFridays() {
  const yearSel = document.getElementById("interactionYearSelect");
  const monthSel = document.getElementById("interactionMonthSelect");
  const dateSel = document.getElementById("interactionDateSelect");
  dateSel.innerHTML = "";
  const year = +yearSel.value;
  const month = +monthSel.value - 1;
  const daysInMonth = new Date(year, month+1, 0).getDate();
  for(let d=1; d<=daysInMonth; d++){
    const date = new Date(year, month, d);
    if(date.getDay() === 5){ // ููู ุงูุฌูุนุฉ
      const opt = document.createElement("option");
      opt.value = d;
      opt.textContent = `${d}/${month+1}/${year}`;
      dateSel.appendChild(opt);
    }
  }
}

// ุงุณุชุฏุนุงุก ุนูุฏ ุชุบููุฑ ุงูุณูุฉ ุฃู ุงูุดูุฑ
document.getElementById("interactionYearSelect").onchange = fillInteractionFridays;
document.getElementById("interactionMonthSelect").onchange = fillInteractionFridays;

// ุงุณุชุฏุนุงุก ุนูุฏ ุชุญููู ุงูุตูุญุฉ
fillInteractionFridays();

    document.getElementById("showAbsenceReport").addEventListener("click", async () => {
  const name = document.getElementById("absenceReportChildName").value.trim();
  const year = document.getElementById("absenceReportYear").value;
  const month = document.getElementById("absenceReportMonth").value;
  const container = document.getElementById("absenceReportResult");
  
  if (!name) {
    alert("ุงุฏุฎู ุงุณู ุงูุทูู");
    return;
  }
  
  container.innerHTML = "ุฌุงุฑู ุงูุชุญููู...";
  
  try {
    const res = await fetch(`${apiURL}?type=absenceReport&name=${encodeURIComponent(name)}&year=${year}&month=${month}`);
    const data = await res.json();
    if (data.records && data.records.length > 0) {
      container.innerHTML = `<table>
        <tr><th>ุงูุชุงุฑูุฎ</th><th>ููุน ุงูุงูุชูุงุฏ</th><th>ุงุณู ุงูุฎุงุฏู</th><th>ุงูููุงุญุธุงุช</th></tr>` +
        data.records.map(r=>`<tr><td>${r.date}/${r.month}/${r.year}</td><td>${r.absenceType}</td><td>${r.staff}</td><td>${r.notes}</td></tr>`).join("") +
        `</table>`;
    } else {
      container.innerHTML = "ูุง ุชูุฌุฏ ุจูุงูุงุช ููุฐุง ุงูุทูู ูู ูุฐุง ุงูุดูุฑ";
    }
  } catch {
    container.innerHTML = "โ ูู ูุชู ุงูุงุชุตุงู ุจุงูุฎุงุฏู.";
  }
});

    function fillAbsenceDates() {
  const yearSel = document.getElementById("absenceYear");
  const monthSel = document.getElementById("absenceMonth");
  const dateSel = document.getElementById("absenceDate");
  dateSel.innerHTML = "";
  const year = +yearSel.value;
  const month = +monthSel.value - 1;
  const daysInMonth = new Date(year, month+1, 0).getDate();
  for(let d=1; d<=daysInMonth; d++){
    const opt = document.createElement("option");
    opt.value = d;
    opt.textContent = `${d}/${month+1}/${year}`;
    dateSel.appendChild(opt);
  }
}

// ุงุณุชุฏุนุงุก ุนูุฏ ุชุบููุฑ ุงูุณูุฉ ุฃู ุงูุดูุฑ
document.getElementById("absenceYear").onchange = fillAbsenceDates;
document.getElementById("absenceMonth").onchange = fillAbsenceDates;

// ุงุณุชุฏุนุงุก ุนูุฏ ุชุญููู ุงูุตูุญุฉ
fillAbsenceDates();

    async function showAbsenceReport() {
  const name = document.getElementById("absenceReportName").value.trim();
  const year = document.getElementById("absenceReportYear").value;
  const month = document.getElementById("absenceReportMonth").value;

  if (!name || !year || !month) {
    alert("ูู ูุถูู ุงุฎุชุฑ ุงูุงุณู ูุงูุณูุฉ ูุงูุดูุฑ ุฃููุงู");
    return;
  }

  try {
    const response = await fetch(`${SCRIPT_URL}?type=absenceReport&name=${encodeURIComponent(name)}&year=${year}&month=${month}`);
    const data = await response.json();

    console.log("๐ absence report data:", data.records); // ุนุดุงู ุชุดูู ุดูู ุงูุจูุงูุงุช ูู console

    const tableBody = document.getElementById("absenceReportTableBody");
    tableBody.innerHTML = "";

    if (!data.records || data.records.length === 0) {
      tableBody.innerHTML = `<tr><td colspan="4">ูุง ุชูุฌุฏ ุจูุงูุงุช ุงูุชูุงุฏ ููุฐุง ุงูุทูู ูู ูุฐุง ุงูุดูุฑ</td></tr>`;
      return;
    }

    // ุนุฑุถ ูู ุณุฌู ุงูุชูุงุฏ
    data.records.forEach(r => {
      // ูู ุงูุฃุนูุฏุฉ ุนูุฏู ูู ุงูุดูุช ูุฑุชุจุฉ ูุงูุชุงูู:
      // ุงูุงุณู | ุงูุณูุฉ | ุงูุดูุฑ | ุงูุชุงุฑูุฎ | ุงูุญุถูุฑ | ุฌุงุจ ุงูููุชุฉ | ุงูุชูุงุนู | ุขุฎุฑ ุชุนุฏูู | ููุน ุงูุงูุชูุงุฏ | ุงุณู ุงูุฎุงุฏู | ุงูููุงุญุธุงุช
      // ูุจูู ุงูููุงุชูุญ ูุชููู ุจุงูุดูู ุฏู:
      const yearVal = r.year || r[1] || "";
      const monthVal = r.month || r[2] || "";
      const dateVal = r.date || r[3] || "";
      const absenceType = r.absenceType || r["ููุน ุงูุงูุชูุงุฏ"] || r[8] || "";
      const staff = r.staff || r["ุงุณู ุงูุฎุงุฏู"] || r[9] || "";
      const notes = r.notes || r["ุงูููุงุญุธุงุช ุงูุฎุงุตุฉ ุจุงูุงูุชูุงุฏ"] || r[10] || "";

      const row = `
        <tr>
          <td>${dateVal}/${monthVal}/${yearVal}</td>
          <td>${absenceType}</td>
          <td>${staff}</td>
          <td>${notes}</td>
        </tr>
      `;
      tableBody.insertAdjacentHTML("beforeend", row);
    });

  } catch (err) {
    console.error("โ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุชูุฑูุฑ ุงูุงูุชูุงุฏ:", err);
    alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงูุจูุงูุงุชุ ุญุงูู ูุฑุฉ ุฃุฎุฑู.");
  }
}

    document.getElementById("saveChildBtn").addEventListener("click", async () => {
  const btn = document.getElementById("saveChildBtn");
  const resultDiv = document.getElementById("addEditResult");
  btn.disabled = true;
  resultDiv.textContent = "โณ ุฌุงุฑู ุงูุญูุธ...";

  const data = {
  type: "addEditChild",
  name: document.getElementById("ae_name").value.trim(),
  group: document.getElementById("ae_group").value.trim(),
  day: document.getElementById("ae_day").value,
  month: document.getElementById("ae_month").value,
  year: document.getElementById("ae_year").value,
  school: document.getElementById("ae_school").value.trim(),
  schoolYear: document.getElementById("ae_schoolYear").value.trim(),
  confession: document.getElementById("ae_confession").value.trim(),
  area: document.getElementById("ae_area").value.trim(),
  street: document.getElementById("ae_street").value.trim(),
  near: document.getElementById("ae_near").value.trim(),
  homeNum: document.getElementById("ae_homeNum").value.trim(),
  homePhone: document.getElementById("ae_homePhone").value.trim(),
  fatherPhone: document.getElementById("ae_fatherPhone").value.trim(),
  fatherJob: document.getElementById("ae_fatherJob").value.trim(),
  motherPhone: document.getElementById("ae_motherPhone").value.trim(),
  motherJob: document.getElementById("ae_motherJob").value.trim(),
  photo: document.getElementById("ae_photo").value.trim(),

  // ุงูุฅุฎูุฉ
  brother1: document.getElementById("ae_brother1").value.trim(),
  brother1Age: document.getElementById("ae_brother1Age").value,
  brother2: document.getElementById("ae_brother2").value.trim(),
  brother2Age: document.getElementById("ae_brother2Age").value,
  brother3: document.getElementById("ae_brother3").value.trim(),
  brother3Age: document.getElementById("ae_brother3Age").value,
  brother4: document.getElementById("ae_brother4").value.trim(),
  brother4Age: document.getElementById("ae_brother4Age").value,
  brother5: document.getElementById("ae_brother5").value.trim(),
  brother5Age: document.getElementById("ae_brother5Age").value,

  // ุงูุณูุงุช
  loveLangs: document.getElementById("ae_loveLangs").value.trim(),
  traits: document.getElementById("ae_traits").value.trim(),
  talents: document.getElementById("ae_talents").value.trim(),
  bestWays: document.getElementById("ae_bestWays").value.trim(),
  problems: document.getElementById("ae_problems").value.trim()
};

  try {
    const res = await fetch(apiURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const result = await res.json();
    if(result.success){
  alert("โ ุชู ุญูุธ ุงูุจูุงูุงุช ุจูุฌุงุญ!");
  clearAddEditForm();
} else {
      resultDiv.textContent = "โ๏ธ " + (result.message || "ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญูุธ");
    }
  } catch (err) {
    resultDiv.textContent = "โ๏ธ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุงุชุตุงู ุจุงูุฎุงุฏู";
    console.error(err);
  }
  btn.disabled = false;
});

    fillYearSelect(document.getElementById("ae_att_year"));
fillMonthSelect(document.getElementById("ae_att_month"));
fillFridays(document.getElementById("ae_att_year"), document.getElementById("ae_att_month"), document.getElementById("ae_att_day"));
document.getElementById("ae_att_year").onchange = () => fillFridays(document.getElementById("ae_att_year"), document.getElementById("ae_att_month"), document.getElementById("ae_att_day"));
document.getElementById("ae_att_month").onchange = () => fillFridays(document.getElementById("ae_att_year"), document.getElementById("ae_att_month"), document.getElementById("ae_att_day"));

fillYearSelect(document.getElementById("ae_interact_year"));
fillMonthSelect(document.getElementById("ae_interact_month"));
fillFridays(document.getElementById("ae_interact_year"), document.getElementById("ae_interact_month"), document.getElementById("ae_interact_day"));

fillYearSelect(document.getElementById("ae_abs_year"));
fillMonthSelect(document.getElementById("ae_abs_month"));
fillFridays(document.getElementById("ae_abs_year"), document.getElementById("ae_abs_month"), document.getElementById("ae_abs_day"));

// ุฒุฑ ุญูุธ ุงูุญุถูุฑ
document.getElementById("ae_att_btn").addEventListener("click", async () => {
  const name = document.getElementById("ae_att_name").value.trim();
  const year = document.getElementById("ae_att_year").value;
  const month = document.getElementById("ae_att_month").value;
  const date = document.getElementById("ae_att_day").value;
  const attendance = document.querySelector('input[name="ae_att_status"]:checked')?.value || "";
  const notebook = document.querySelector('input[name="ae_att_notebook"]:checked')?.value || "";

  await fetch(apiURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ type: "updateAttendance", name, year, month, date, attendance, notebook })
  });
});

// ุฒุฑ ุญูุธ ุงูุชูุงุนู
document.getElementById("ae_interact_btn").addEventListener("click", async () => {
  const name = document.getElementById("ae_interact_name").value.trim();
  const year = document.getElementById("ae_interact_year").value;
  const month = document.getElementById("ae_interact_month").value;
  const date = document.getElementById("ae_interact_day").value;
  const points = document.getElementById("ae_interact_points").value;

  await fetch(apiURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ type: "updateInteraction", name, year, month, date, points })
  });
});

// ุฒุฑ ุญูุธ ุงูุงูุชูุงุฏ
document.getElementById("ae_abs_btn").addEventListener("click", async () => {
  const name = document.getElementById("ae_abs_name").value.trim();
  const year = document.getElementById("ae_abs_year").value;
  const month = document.getElementById("ae_abs_month").value;
  const date = document.getElementById("ae_abs_day").value;
  const absenceType = document.getElementById("ae_abs_type").value;
  const staff = document.getElementById("ae_abs_staff").value;
  const notes = document.getElementById("ae_abs_notes").value.trim();

  await fetch(apiURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ type: "updateAbsence", name, year, month, date, absenceType, staff, notes })
  });
});

    // ุชุนุจุฆุฉ ุงูุณููุงุช
fillYearSelect(document.getElementById("ae_year"), 2010, 2025);

// ุชุนุจุฆุฉ ุงูุดููุฑ
fillMonthSelect(document.getElementById("ae_month"));

// ุชุนุจุฆุฉ ุฃูุงู ุงูุฌูุนุฉ ุชููุงุฆููุง ุญุณุจ ุงูุณูุฉ ูุงูุดูุฑ
document.getElementById("ae_year").onchange = () => {
  fillFridays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));
};
document.getElementById("ae_month").onchange = () => {
  fillFridays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));
};

// ุชุนุจุฆุฉ ุฃูููุฉ
fillFridays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));

    fillYearSelect(document.getElementById("ae_year"), 2010, 2025);
fillMonthSelect(document.getElementById("ae_month"));

document.getElementById("ae_year").onchange = () => {
  fillAllDays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));
};
document.getElementById("ae_month").onchange = () => {
  fillAllDays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));
};

// ุชุนุจุฆุฉ ุฃูููุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
fillAllDays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));

document.getElementById("ae_year").onchange = () => {
  fillAllDays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));
};
document.getElementById("ae_month").onchange = () => {
  fillAllDays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));
};
fillAllDays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));


    document.getElementById("absenceYear").onchange = () => {
  fillAllDays(document.getElementById("absenceYear"), document.getElementById("absenceMonth"), document.getElementById("absenceDate"));
};
document.getElementById("absenceMonth").onchange = () => {
  fillAllDays(document.getElementById("absenceYear"), document.getElementById("absenceMonth"), document.getElementById("absenceDate"));
};
fillAllDays(document.getElementById("absenceYear"), document.getElementById("absenceMonth"), document.getElementById("absenceDate"));

    // ุชุนุจุฆุฉ ุงูุณููุงุช ูุงูุดููุฑ ูุชุนุฏูู ุงูุงูุชูุงุฏ
fillYearSelect(document.getElementById("ae_year"), 2010, 2025);
fillMonthSelect(document.getElementById("ae_month"));

// ุชุนุจุฆุฉ ุงูุฃูุงู ุชููุงุฆููุง ุนูุฏ ุชุบููุฑ ุงูุณูุฉ ุฃู ุงูุดูุฑ
document.getElementById("ae_year").onchange = () => {
  fillAllDays(
    document.getElementById("ae_year"),
    document.getElementById("ae_month"),
    document.getElementById("ae_day")
  );
};
document.getElementById("ae_month").onchange = () => {
  fillAllDays(
    document.getElementById("ae_year"),
    document.getElementById("ae_month"),
    document.getElementById("ae_day")
  );
};

// ุชุนุจุฆุฉ ุฃูููุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
fillAllDays(
  document.getElementById("ae_year"),
  document.getElementById("ae_month"),
  document.getElementById("ae_day")
);

    function clearAddEditForm(){
  const fields = [
    "ae_name", "ae_group", "ae_school", "ae_schoolYear", "ae_confession", "ae_area",
    "ae_street", "ae_near", "ae_homeNum", "ae_homePhone", "ae_fatherPhone", "ae_fatherJob",
    "ae_motherPhone", "ae_motherJob", "ae_brother1", "ae_brother1Age", "ae_brother2", "ae_brother2Age",
    "ae_brother3", "ae_brother3Age", "ae_brother4", "ae_brother4Age", "ae_brother5", "ae_brother5Age",
    "ae_loveLangs", "ae_traits", "ae_talents", "ae_bestWays", "ae_problems", "ae_photo"
  ];

  fields.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = "";
  });

  // ุฅุนุงุฏุฉ ุชุนุจุฆุฉ ุงูุฃูุงู ุญุณุจ ุงูุณูุฉ ูุงูุดูุฑ ุงูุญุงูููู
  fillAllDays(
    document.getElementById("ae_year"),
    document.getElementById("ae_month"),
    document.getElementById("ae_day")
  );
}

    document.getElementById("ae_year").onchange = () => {
  fillAllDays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));
};
document.getElementById("ae_month").onchange = () => {
  fillAllDays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));
};
fillAllDays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));

   function fillAllDays(yearSel, monthSel, dateSel){
  if (!yearSel || !monthSel || !dateSel) return;
  dateSel.innerHTML = "";
  const year = +yearSel.value;
  const month = +monthSel.value - 1;
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  for(let d = 1; d <= daysInMonth; d++){
    const opt = document.createElement("option");
    opt.value = d;
    opt.textContent = `${d}/${month + 1}/${year}`;
    dateSel.appendChild(opt);
  }
}

window.onload = () => {
  fillYearSelect(document.getElementById("ae_year"), 2010, 2025);
  fillMonthSelect(document.getElementById("ae_month"));
  fillAllDays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));

  document.getElementById("ae_year").onchange = () => {
    fillAllDays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));
  };
  document.getElementById("ae_month").onchange = () => {
    fillAllDays(document.getElementById("ae_year"), document.getElementById("ae_month"), document.getElementById("ae_day"));
  };
};

    fillYearSelect(document.getElementById("giftYear"));
fillMonthSelect(document.getElementById("giftMonth"));
fillAllDays(document.getElementById("giftYear"), document.getElementById("giftMonth"), document.getElementById("giftDay"));

    document.getElementById("giftYear").onchange = () => {
  fillAllDays(document.getElementById("giftYear"), document.getElementById("giftMonth"), document.getElementById("giftDay"));
};
document.getElementById("giftMonth").onchange = () => {
  fillAllDays(document.getElementById("giftYear"), document.getElementById("giftMonth"), document.getElementById("giftDay"));
};
setupSuggestions(document.getElementById("giftName"), document.getElementById("giftSuggestions"));

    document.getElementById("showGiftReport").addEventListener("click", async () => {
  const name = document.getElementById("giftReportName").value.trim();
  const year = document.getElementById("giftReportYear").value;
  const resultDiv = document.getElementById("giftReportResult");

  if (!name || !year) return alert("โ ูุงุฒู ุชุฎุชุงุฑ ุงูุงุณู ูุงูุณูุฉ");

  resultDiv.innerHTML = "โณ ุฌุงุฑู ุงูุชุญููู...";

  try {
    const res = await fetch(`${apiURL}?type=giftReport&name=${encodeURIComponent(name)}&year=${year}`);
    const data = await res.json();

    if (!data.records || data.records.length === 0) {
      resultDiv.innerHTML = "โ ูุง ููุฌุฏ ูุฏุงูุง ูุณุฌูุฉ ููุฐุง ุงูุทูู ูู ูุฐู ุงูุณูุฉ.";
      return;
    }

    resultDiv.innerHTML = "<ul>" + data.records.map(r =>
      `<li>๐ ${r.day}/${r.month}/${r.year} - ๐ ุจูุงุณุทุฉ: ${r.staff}</li>`
    ).join("") + "</ul>";
  } catch {
    resultDiv.innerHTML = "โ๏ธ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงูุชูุฑูุฑ.";
  }
});

    window.addEventListener("DOMContentLoaded", () => {
  const loginBtn = document.getElementById("loginBtn");
  if (!loginBtn) return; // ุญูุงูุฉ ูู ูุด ููุฌูุฏ

  loginBtn.addEventListener("click", async () => {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    const errorDiv = document.getElementById("loginError");

    if (!username || !password) {
  errorDiv.textContent = "โ ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู ููููุฉ ุงููุฑูุฑ";
  errorDiv.style.display = "block";
  return;
}

errorDiv.textContent = "โณ ุฌุงุฑู ุงูุชุญูู...";
errorDiv.style.display = "block";

try {
  const res = await fetch(`${apiURL}?type=login&username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`);
  const data = await res.json();
  console.log("๐ login result:", data);

  if (!data.success) {
    errorDiv.textContent = "โ ุงุณู ุงููุณุชุฎุฏู ุฃู ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ";
    errorDiv.style.display = "block";
    return;
  }
    userGroups = (data.groups || []).map(g => g.trim());
await loadNames(userGroups);
initAttendance();

  // โ ุชุณุฌูู ุงูุฏุฎูู ูุงุฌุญ
  errorDiv.style.display = "none";
  const login = document.getElementById("loginSection");
  const main = document.getElementById("mainContent");
  login.style.opacity = "0";
  login.style.transition = "opacity 0.5s";
  setTimeout(() => {
    login.style.display = "none";
    main.style.display = "block";
  }, 500);
} catch {
  errorDiv.textContent = "โ๏ธ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุงุชุตุงู ุจุงูุฎุงุฏู";
  errorDiv.style.display = "block";
}
  });
});

    document.getElementById("editChildBtn").addEventListener("click", async () => {
  const name = document.getElementById("editChildName").value.trim();
  const field = document.getElementById("editField").value;
  const value = document.getElementById("editNewValue").value.trim();

  if (!name || !field || !value) {
    alert("โ ูุฑุฌู ุฅุฏุฎุงู ุฌููุน ุงูุจูุงูุงุช");
    return;
  }

  try {
    const res = await fetch(apiURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        type: "editField",
        name,
        field,
        value
      })
    });
    const result = await res.json();
    if (result.success) {
      alert("โ ุชู ุชุนุฏูู ุงูุจูุงูุงุช ุจูุฌุงุญ!");
      document.getElementById("editNewValue").value = "";
    } else {
      alert("โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุนุฏูู.");
    }
  } catch {
    alert("โ๏ธ ูู ูุชู ุงูุงุชุตุงู ุจุงูุฎุงุฏู.");
  }
});

    function convertDriveLinkToImageURL(link) {
  const match = link.match(/\/d\/([^\/]+)\//);
  return match ? `https://drive.google.com/uc?export=view&id=${match[1]}` : "";
}

    document.getElementById("showStaffReport").addEventListener("click", async () => {
  const staff = document.getElementById("staffReportName").value.trim();
  const year = document.getElementById("staffReportYear").value;
  const month = document.getElementById("staffReportMonth").value;
  const container = document.getElementById("staffReportResult");

  if (!staff || !year || !month) {
    container.innerHTML = "โ ุงุฎุชุฑ ูู ุงูุจูุงูุงุช ุฃูููุง";
    return;
  }

  container.innerHTML = "โณ ุฌุงุฑู ุชุญููู ุงูุชูุฑูุฑ...";
  try {
    const res = await fetch(`${apiURL}?type=absenceReport&year=${year}&month=${month}&staff=${encodeURIComponent(staff)}`);
    const data = await res.json();

    if (data.records && data.records.length > 0) {
      let html = `<p>ุนุฏุฏ ุงูุงูุชูุงุฏุงุช: ${data.records.length}</p>`;
      html += `<table><tr><th>ุงูุชุงุฑูุฎ</th><th>ุงูุทูู</th><th>ุงูููุน</th><th>ุงูููุงุญุธุงุช</th></tr>`;
      data.records.forEach(r => {
        html += `<tr><td>${r.date}/${r.month}/${r.year}</td><td>${r.name}</td><td>${r.absenceType}</td><td>${r.notes || "-"}</td></tr>`;
      });
      html += `</table>`;
      container.innerHTML = html;
    } else {
      container.innerHTML = "โ ูุง ููุฌุฏ ุงูุชูุงุฏุงุช ููุฐุง ุงูุฎุงุฏู ูู ูุฐุง ุงูุดูุฑ.";
    }
  } catch (err) {
    container.innerHTML = "โ๏ธ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงูุชูุฑูุฑ.";
    console.error(err);
  }
});

</script>
</body>
</html>
